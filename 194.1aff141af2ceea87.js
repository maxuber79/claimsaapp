"use strict";(self.webpackChunkclaims_app=self.webpackChunkclaims_app||[]).push([[194],{2194:(C,f,s)=>{s.r(f),s.d(f,{NotificationsComponent:()=>k});var g=s(467),u=s(2881),d=s(4341),m=s(5207),e=s(1360),_=s(5072),p=s(4796),h=s(7473),b=s(9332);const v=()=>["/dashboard"],E=(o,l,t,n,i)=>({"badge-full-danger":o,"badge-full-success":l,"badge-full-warning":t,"badge-full-primary":n,"badge-full-secondary":i});function F(o,l){if(1&o){const t=e.RV6();e.j41(0,"div",40)(1,"div",1)(2,"div",41),e.nrm(3,"strong",42)(4,"br"),e.j41(5,"small",43),e.EFF(6),e.k0s(),e.EFF(7," | "),e.j41(8,"small",44),e.EFF(9),e.k0s()(),e.j41(10,"div",45)(11,"button",46),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.markAsRead(i))}),e.nrm(12,"i",47),e.EFF(13),e.k0s(),e.j41(14,"button",48),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.deleteNotification(i))}),e.nrm(15,"i",49),e.EFF(16," Eliminar "),e.k0s()()()()}if(2&o){const t=l.$implicit;e.R7$(3),e.Y8G("innerHTML",t.message,e.npT),e.R7$(3),e.SpI("Le\xedda: ",t.read?"S\xed":"No",""),e.R7$(2),e.Y8G("ngClass",e.s1E(8,E,"urgente"===t.type,"asignado"===t.type,"editado"===t.type,"cerrado"===t.type,"admin-alert"===t.type)),e.R7$(),e.SpI(" ","asignado"===t.type?"Asignado":"urgente"===t.type?"Urgente":"editado"===t.type?"Editado":"admin-alert"===t.type?"Nueva Modificaci\xf3n":"cerrado"===t.type?"Cerrado":t.type," "),e.R7$(2),e.Y8G("ngClass",t.read?"btn-full --warning":"btn-full --success")("disabled",t.read),e.R7$(),e.Y8G("ngClass",t.read?"bi bi-check-all":"bi-check-lg"),e.R7$(),e.SpI(" ",t.read?"Notificaci\xf3n le\xedda":"Marcar como le\xedda"," ")}}function P(o,l){if(1&o&&(e.j41(0,"div"),e.DNE(1,F,17,14,"div",39),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.pagedNotifications)}}function N(o,l){1&o&&(e.j41(0,"div",50),e.EFF(1,"No hay notificaciones"),e.k0s())}function j(o,l){if(1&o){const t=e.RV6();e.j41(0,"li",36)(1,"a",37),e.bIt("click",function(i){const a=e.eBV(t).$implicit;return e.XpG().onPageChange(a),e.Njj(i.preventDefault())}),e.EFF(2),e.k0s()()}if(2&o){const t=l.$implicit,n=e.XpG();e.AVh("active",t===n.currentPage),e.R7$(2),e.JRh(t)}}let k=(()=>{class o{route;auth;notificationService;alertService;uid="";notifications=[];loading=!0;filterState="todas";fechaOrden="desc";currentPage=1;itemsPerPage=10;constructor(t,n,i,a){this.route=t,this.auth=n,this.notificationService=i,this.alertService=a,console.log("\u{1f514} Componente de notificaciones inicializado")}ngOnInit(){var t=this;return(0,g.A)(function*(){const n=t.route.snapshot.paramMap.get("uid");if(console.log("\u{1f50d} UID encontrado en componente de notificaciones:",n),n){t.notificationService.getUserNotifications(n).subscribe({next:i=>{t.notifications=i,console.log("\u{1f4e8} Notificaciones cargadas:",t.notifications)},error:i=>{console.error("\u274c Error cargando notificaciones:",i)}});try{console.log("\u{1f4e8} Notificaciones cargadas:",t.notifications)}catch(i){console.error("\u274c Error cargando notificaciones:",i)}finally{t.loading=!1}}else console.warn("\u274c No se encontr\xf3 UID en la ruta")})()}loadNotifications(){this.notificationService.getUserNotifications(this.uid).subscribe({next:t=>{this.notifications=t??[],this.currentPage=Math.min(this.currentPage,this.totalPages)},error:t=>console.error("\u274c Error al cargar notificaciones (exec):",t)})}asDate(t){return t?t instanceof Date?t:"number"==typeof t?new Date(t):t.toDate?t.toDate():new Date(t):new Date(0)}get filteredNotifications(){let t=[...this.notifications];return"leidas"===this.filterState?t=t.filter(n=>n.read):"no-leidas"===this.filterState&&(t=t.filter(n=>!n.read)),t.sort((n,i)=>{const a=this.asDate(n.timestamp).getTime(),r=this.asDate(i.timestamp).getTime();return"asc"===this.fechaOrden?a-r:r-a}),t}get totalItems(){return this.filteredNotifications.length}get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.itemsPerPage))}get pages(){return Array.from({length:this.totalPages},(t,n)=>n+1)}get pagedNotifications(){const t=(this.currentPage-1)*this.itemsPerPage;return this.filteredNotifications.slice(t,t+this.itemsPerPage)}onPageChange(t){t<1||t>this.totalPages||(this.currentPage=t)}onItemsPerPageChange(t){const n=Number(t.target.value);this.itemsPerPage=n,this.currentPage=1}onFiltersChanged(){this.currentPage=1}markAsRead(t){t.read||!t.id||this.notificationService.markAsRead(this.uid,t.id).then(()=>t.read=!0).catch(n=>console.error("\u274c Error al marcar como le\xedda (exec):",n))}deleteNotification(t){t.id&&this.notificationService.deleteNotification(this.uid,t.id).then(()=>{this.notifications=this.notifications.filter(n=>n.id!==t.id),(this.currentPage-1)*this.itemsPerPage>=this.totalItems&&(this.currentPage=Math.max(1,this.currentPage-1))}).catch(n=>console.error("\u274c Error al eliminar notificaci\xf3n (exec):",n))}markAllAsRead(){this.notificationService.markAllAsRead(this.uid).then(()=>this.notifications=this.notifications.map(t=>({...t,read:!0}))).catch(t=>console.error("\u274c Error al marcar todas (exec):",t))}get allRead(){return this.notifications.length>0&&this.notifications.every(t=>t.read)}static \u0275fac=function(n){return new(n||o)(e.rXU(_.nX),e.rXU(p.u),e.rXU(h.J),e.rXU(b.u))};static \u0275cmp=e.VBU({type:o,selectors:[["app-notifications"]],decls:74,vars:26,consts:[["noNotificaciones",""],[1,"row"],[1,"col-12","text-start","grid-margin"],[1,"card"],[1,"card-body"],[1,"col-12"],["aria-label","breadcrumb",1,""],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"col-12","grid-margin"],[1,"col-sm-12","col-md-6"],[1,"bi","bi-bell-fill","text-warning"],[1,"badge","badge-type","badge-outline-info"],[1,"col-sm-12","col-md-6","d-flex","justify-content-end"],[1,"btn","btn-full","--success","m-1","btn-sm",3,"click","disabled"],[1,"bi","bi-check2-all"],[1,"col-sm-12","col-md-6","d-flex","justify-content-between","align-items-center"],[1,"py-3"],[1,"me-2","fw-semibold"],["role","group",1,"btn-group"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"col-sm-12","col-md-6","d-flex","justify-content-end","align-items-center"],[1,"form-select","form-select-sm","d-inline-block","w-auto",3,"ngModelChange","ngModel"],["value","desc"],["value","asc"],[1,"col-sm-12","col-md-12"],[4,"ngIf","ngIfElse"],[1,"col-12","d-flex","justify-content-between","align-items-center","py-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"change","ngModel"],[3,"value"],["aria-label","Page navigation"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],["class","list-group-item border my-2 p-3 rounded bg-light",4,"ngFor","ngForOf"],[1,"list-group-item","border","my-2","p-3","rounded","bg-light"],[1,"col-sm-12","col-md-6","py-2"],[3,"innerHTML"],[1,"text-muted"],[1,"badge",3,"ngClass"],[1,"col-sm-12","col-md-6","py-2","d-flex","justify-content-md-end","align-items-md-center"],[1,"btn","m-1","btn-sm",3,"click","ngClass","disabled"],[1,"bi",3,"ngClass"],[1,"btn","btn-full","--danger","m-1","btn-sm",3,"click"],[1,"bi","bi-trash3-fill"],[1,"alert","alert-info","mt-3"]],template:function(n,i){if(1&n){const a=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",1)(5,"div",5)(6,"nav",6)(7,"ol",7)(8,"li",8)(9,"a",9),e.EFF(10,"Home"),e.k0s()(),e.j41(11,"li",10),e.EFF(12,"Admin Notificaciones"),e.k0s()()()()()()()()(),e.j41(13,"div",1)(14,"div",11)(15,"div",3)(16,"div",4)(17,"div",1)(18,"div",12)(19,"h2"),e.nrm(20,"i",13),e.EFF(21," Notificaciones "),e.j41(22,"small",14),e.EFF(23),e.k0s()()(),e.j41(24,"div",15)(25,"button",16),e.bIt("click",function(){return e.eBV(a),e.Njj(i.markAllAsRead())}),e.nrm(26,"i",17),e.EFF(27," Marcar todas como le\xeddas "),e.k0s()(),e.j41(28,"div",18)(29,"div",19)(30,"span",20),e.EFF(31,"Ordenar por estado:"),e.k0s(),e.j41(32,"div",21)(33,"button",22),e.bIt("click",function(){return e.eBV(a),i.filterState="todas",e.Njj(i.onFiltersChanged())}),e.EFF(34,"Todas"),e.k0s(),e.j41(35,"button",23),e.bIt("click",function(){return e.eBV(a),i.filterState="leidas",e.Njj(i.onFiltersChanged())}),e.EFF(36,"Le\xeddas"),e.k0s(),e.j41(37,"button",24),e.bIt("click",function(){return e.eBV(a),i.filterState="no-leidas",e.Njj(i.onFiltersChanged())}),e.EFF(38,"No le\xeddas"),e.k0s()()()(),e.j41(39,"div",25)(40,"span",20),e.EFF(41,"Ordenar por fecha:"),e.k0s(),e.j41(42,"select",26),e.mxI("ngModelChange",function(c){return e.eBV(a),e.DH7(i.fechaOrden,c)||(i.fechaOrden=c),e.Njj(c)}),e.bIt("ngModelChange",function(){return e.eBV(a),e.Njj(i.onFiltersChanged())}),e.j41(43,"option",27),e.EFF(44,"M\xe1s reciente primero"),e.k0s(),e.j41(45,"option",28),e.EFF(46,"M\xe1s antigua primero"),e.k0s()()(),e.j41(47,"div",29),e.DNE(48,P,2,1,"div",30)(49,N,2,0,"ng-template",null,0,e.C5r),e.k0s(),e.j41(51,"div",31)(52,"div"),e.EFF(53," Elementos por p\xe1gina: "),e.j41(54,"select",32),e.bIt("change",function(c){return e.eBV(a),e.Njj(i.onItemsPerPageChange(c))}),e.j41(55,"option",33),e.EFF(56,"10"),e.k0s(),e.j41(57,"option",33),e.EFF(58,"25"),e.k0s(),e.j41(59,"option",33),e.EFF(60,"50"),e.k0s(),e.j41(61,"option",33),e.EFF(62,"100"),e.k0s()()(),e.j41(63,"nav",34)(64,"ul",35)(65,"li",36)(66,"a",37),e.bIt("click",function(c){return e.eBV(a),i.onPageChange(i.currentPage-1),e.Njj(c.preventDefault())}),e.EFF(67,"Anterior"),e.k0s()(),e.DNE(68,j,3,3,"li",38),e.j41(69,"li",36)(70,"a",37),e.bIt("click",function(c){return e.eBV(a),i.onPageChange(i.currentPage+1),e.Njj(c.preventDefault())}),e.EFF(71,"Siguiente"),e.k0s()()()(),e.j41(72,"div"),e.EFF(73),e.k0s()()()()()()()}if(2&n){const a=e.sdS(50);e.R7$(9),e.Y8G("routerLink",e.lJ4(25,v)),e.R7$(14),e.Lme(" ",i.filteredNotifications.length," notificaci\xf3n",1===i.filteredNotifications.length?"":"es"," "),e.R7$(2),e.Y8G("disabled",i.allRead),e.R7$(8),e.AVh("active","todas"===i.filterState),e.R7$(2),e.AVh("active","leidas"===i.filterState),e.R7$(2),e.AVh("active","no-leidas"===i.filterState),e.R7$(5),e.R50("ngModel",i.fechaOrden),e.R7$(6),e.Y8G("ngIf",i.filteredNotifications.length>0)("ngIfElse",a),e.R7$(6),e.Y8G("ngModel",i.itemsPerPage),e.R7$(),e.Y8G("value",10),e.R7$(2),e.Y8G("value",25),e.R7$(2),e.Y8G("value",50),e.R7$(2),e.Y8G("value",100),e.R7$(4),e.AVh("disabled",1===i.currentPage),e.R7$(3),e.Y8G("ngForOf",i.pages),e.R7$(),e.AVh("disabled",i.currentPage===i.totalPages),e.R7$(4),e.Lme(" P\xe1gina ",i.currentPage," de ",i.totalPages," ")}},dependencies:[u.MD,u.YU,u.Sq,u.bT,m.iI,m.Wk,d.YN,d.xH,d.y7,d.wz,d.BC,d.vS],encapsulation:2})}return o})()}}]);