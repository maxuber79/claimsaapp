"use strict";(self.webpackChunkclaims_app=self.webpackChunkclaims_app||[]).push([[51],{3051:(j,f,s)=>{s.r(f),s.d(f,{AdminNotificationsComponent:()=>F});var m=s(2881),d=s(4341),u=s(5207),i=s(1360),g=s(7473),_=s(4796);const p=()=>["/dashboard"],b=(o,r,t,n,e)=>({"badge-full-danger":o,"badge-full-success":r,"badge-full-warning":t,"badge-full-primary":n,"badge-full-secondary":e});function h(o,r){if(1&o){const t=i.RV6();i.j41(0,"div",34)(1,"button",35),i.bIt("click",function(){i.eBV(t);const e=i.XpG();return i.Njj(e.markAllAsRead())}),i.nrm(2,"i",36),i.EFF(3," Marcar todas como le\xeddas "),i.k0s()()}if(2&o){const t=i.XpG();i.R7$(),i.Y8G("disabled",t.allRead)}}function v(o,r){if(1&o){const t=i.RV6();i.j41(0,"div",38)(1,"div",39)(2,"div")(3,"strong",40),i.EFF(4),i.k0s(),i.nrm(5,"br"),i.j41(6,"small",41),i.EFF(7),i.k0s(),i.EFF(8," | "),i.j41(9,"small",42),i.EFF(10),i.k0s()(),i.j41(11,"div",43)(12,"button",44),i.bIt("click",function(){const e=i.eBV(t).$implicit,a=i.XpG(2);return i.Njj(a.markAsRead(e))}),i.nrm(13,"i",45),i.EFF(14),i.k0s(),i.j41(15,"button",46),i.bIt("click",function(){const e=i.eBV(t).$implicit,a=i.XpG(2);return i.Njj(a.deleteNotification(e))}),i.nrm(16,"i",47),i.EFF(17," Eliminar "),i.k0s()()()()}if(2&o){const t=r.$implicit;i.R7$(3),i.Y8G("innerHTML",t.message,i.npT),i.R7$(),i.JRh(t.message),i.R7$(3),i.SpI("Le\xedda: ",t.read?"S\xed":"No",""),i.R7$(2),i.Y8G("ngClass",i.s1E(9,b,"urgente"===t.type,"asignado"===t.type,"editado"===t.type,"cerrado"===t.type,"admin-alert"===t.type)),i.R7$(),i.SpI(" ","asignado"===t.type?"Asignado":"urgente"===t.type?"Urgente":"editado"===t.type?"Editado":"admin-alert"===t.type?"Nueva Modificaci\xf3n":"cerrado"===t.type?"Cerrado":t.type," "),i.R7$(2),i.Y8G("ngClass",t.read?"btn-warning":"btn-full --success")("disabled",t.read),i.R7$(),i.Y8G("ngClass",t.read?"bi-check2-circle":"bi-check-lg"),i.R7$(),i.SpI(" ",t.read?"Notificaci\xf3n le\xedda":"Marcar como le\xedda"," ")}}function k(o,r){if(1&o&&(i.j41(0,"div"),i.DNE(1,v,18,15,"div",37),i.k0s()),2&o){const t=i.XpG();i.R7$(),i.Y8G("ngForOf",t.filteredNotifications)}}function E(o,r){1&o&&(i.j41(0,"div",1)(1,"div",5)(2,"div",48),i.EFF(3," No tienes notificaciones. "),i.k0s()()())}function N(o,r){if(1&o){const t=i.RV6();i.j41(0,"nav",49)(1,"ul",50)(2,"li",51)(3,"button",52),i.bIt("click",function(){i.eBV(t);const e=i.XpG();return i.Njj(e.currentPage=e.currentPage-1)}),i.EFF(4,"Anterior"),i.k0s()(),i.j41(5,"li",53)(6,"span",54),i.EFF(7),i.k0s()(),i.j41(8,"li",51)(9,"button",52),i.bIt("click",function(){i.eBV(t);const e=i.XpG();return i.Njj(e.currentPage=e.currentPage+1)}),i.EFF(10,"Siguiente"),i.k0s()()()()}if(2&o){const t=i.XpG();i.R7$(2),i.AVh("disabled",1===t.currentPage),i.R7$(),i.Y8G("disabled",1===t.currentPage),i.R7$(4),i.Lme("",t.currentPage," / ",t.totalPages,""),i.R7$(),i.AVh("disabled",t.currentPage===t.totalPages),i.R7$(),i.Y8G("disabled",t.currentPage===t.totalPages)}}let F=(()=>{class o{notificationService;authService;notifications=[];uid="";filterState="todas";fechaOrden="desc";currentPage=1;itemsPerPage=10;constructor(t,n){this.notificationService=t,this.authService=n,console.log("\u{1f514} Componente de notificaciones del administrador inicializado")}ngOnInit(){this.authService.getAuthState().subscribe(t=>{t?(this.uid=t.uid,console.log(`%c\u{1f50d} UID: ${this.uid}`,"background: #6610f2; color: #ffffff; padding: 2px 5px;"),this.loadNotifications()):console.error("\u274c No hay usuario autenticado")})}loadNotifications(){this.notificationService.getUserNotifications(this.uid).subscribe({next:t=>{this.notifications=t,console.log("\u{1f514} Notificaciones del admin:",t)},error:t=>console.error("\u274c Error al cargar notificaciones:",t)})}marcarComoLeida(t){t.read||(t.id?this.notificationService.markAsRead(this.uid,t.id).then(()=>t.read=!0).catch(n=>console.error("\u274c Error al marcar como le\xedda:",n)):console.error("\u274c La notificaci\xf3n no tiene un ID v\xe1lido"))}eliminarNotif(t){this.notificationService.deleteNotification(this.uid,t.id?t.id:"").then(()=>{this.notifications=this.notifications.filter(n=>n.id!==t.id)}).catch(n=>console.error("\u274c Error al eliminar notificaci\xf3n:",n))}markAsRead(t){t.read||this.notificationService.markAsRead(this.uid,t.id).then(()=>{t.read=!0,console.log(`\u2705 Notificaci\xf3n ${t.id} marcada como le\xedda`)}).catch(n=>console.error("\u274c Error al marcar como le\xedda:",n))}deleteNotification(t){this.notificationService.deleteNotification(this.uid,t.id).then(()=>{this.notifications=this.notifications.filter(n=>n.id!==t.id),console.log(`\u{1f5d1}\ufe0f Notificaci\xf3n ${t.id} eliminada`)}).catch(n=>console.error("\u274c Error al eliminar notificaci\xf3n:",n))}markAllAsRead(){this.notificationService.markAllAsRead(this.uid).then(()=>{this.notifications=this.notifications.map(t=>({...t,read:!0})),console.log("\u2705 Todas las notificaciones marcadas como le\xeddas.")}).catch(t=>{console.error("\u274c Error al marcar todas como le\xeddas:",t)})}get allRead(){return this.notifications.every(t=>t.read)}get filteredNotifications(){let t=[...this.notifications];switch(this.filterState){case"leidas":t=t.filter(n=>n.read);break;case"no-leidas":t=t.filter(n=>!n.read)}return t.sort((n,e)=>{const a=n.timestamp?.seconds??0,c=e.timestamp?.seconds??0;return"desc"===this.fechaOrden?c-a:a-c}),t}get paginatedNotifications(){const n=(this.currentPage-1)*this.itemsPerPage;return this.filteredNotifications.slice(n,n+this.itemsPerPage)}get totalPages(){return Math.ceil(this.filteredNotifications.length/this.itemsPerPage)}static \u0275fac=function(n){return new(n||o)(i.rXU(g.J),i.rXU(_.u))};static \u0275cmp=i.VBU({type:o,selectors:[["app-admin-notifications"]],decls:62,vars:19,consts:[["noNotifs",""],[1,"row"],[1,"col-12","text-start","grid-margin"],[1,"card"],[1,"card-body"],[1,"col-12"],["aria-label","breadcrumb",1,""],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"col-12","grid-margin"],[1,"col-sm-12","col-md-7","d-flex","justify-content-start","align-items-center"],[1,"bi","bi-bell-fill","text-warning"],[1,"badge","badge-type","badge-outline-info"],[1,"col-sm-12","col-md-5","d-flex","justify-content-end","align-items-center"],["class","mb-3",4,"ngIf"],[1,"col-sm-12","col-md-12","d-flex","justify-content-between","align-items-center","mt-3"],[1,"py-3"],[1,"me-2","fw-semibold"],["role","group",1,"btn-group"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"form-select","form-select-sm","d-inline-block","w-auto",3,"ngModelChange","ngModel"],["value","desc"],["value","asc"],[1,"row","mt-4"],[4,"ngIf","ngIfElse"],[1,"d-inline-block","me-3"],[1,"me-1"],[1,"form-select","form-select-sm","d-inline","w-auto",3,"ngModelChange","change","ngModel"],[3,"value"],["class","",4,"ngIf"],[1,"mb-3"],[1,"btn","btn-full","--success","m-1",3,"click","disabled"],[1,"bi","bi-check2-all"],["class","list-group-item border my-2 p-3 rounded bg-light",4,"ngFor","ngForOf"],[1,"list-group-item","border","my-2","p-3","rounded","bg-light"],[1,"d-flex","justify-content-between","align-items-center"],[3,"innerHTML"],[1,"text-muted"],[1,"badge",3,"ngClass"],[1,"btn-group"],[1,"btn","m-1","btn-sm",3,"click","ngClass","disabled"],[1,"bi",3,"ngClass"],[1,"btn","btn-full","--danger","m-1","btn-sm",3,"click"],[1,"bi","bi-trash3-fill"],[1,"alert","alert-info","my-4"],[1,""],[1,"pagination","pagination-sm","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click","disabled"],[1,"page-item","disabled"],[1,"page-link"]],template:function(n,e){if(1&n){const a=i.RV6();i.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",1)(5,"div",5)(6,"nav",6)(7,"ol",7)(8,"li",8)(9,"a",9),i.EFF(10,"Home"),i.k0s()(),i.j41(11,"li",10),i.EFF(12,"Admin Notificaciones"),i.k0s()()()()()()()()(),i.j41(13,"div",1)(14,"div",11)(15,"div",3)(16,"div",4)(17,"div",1)(18,"div",12)(19,"h2"),i.nrm(20,"i",13),i.EFF(21," Notificaciones del Administrador "),i.j41(22,"small",14),i.EFF(23),i.k0s()()(),i.j41(24,"div",15),i.DNE(25,h,4,1,"div",16),i.k0s(),i.j41(26,"div",17)(27,"div",18)(28,"span",19),i.EFF(29,"Ordenar por estado:"),i.k0s(),i.j41(30,"div",20)(31,"button",21),i.bIt("click",function(){return i.eBV(a),i.Njj(e.filterState="todas")}),i.EFF(32," Todas "),i.k0s(),i.j41(33,"button",22),i.bIt("click",function(){return i.eBV(a),i.Njj(e.filterState="leidas")}),i.EFF(34," Le\xeddas "),i.k0s(),i.j41(35,"button",23),i.bIt("click",function(){return i.eBV(a),i.Njj(e.filterState="no-leidas")}),i.EFF(36," No le\xeddas "),i.k0s()()(),i.j41(37,"div",18)(38,"span",19),i.EFF(39,"Ordenar por fecha:"),i.k0s(),i.j41(40,"select",24),i.mxI("ngModelChange",function(l){return i.eBV(a),i.DH7(e.fechaOrden,l)||(e.fechaOrden=l),i.Njj(l)}),i.j41(41,"option",25),i.EFF(42,"M\xe1s reciente primero"),i.k0s(),i.j41(43,"option",26),i.EFF(44,"M\xe1s antigua primero"),i.k0s()()()(),i.j41(45,"div",5)(46,"div",27),i.DNE(47,k,2,1,"div",28)(48,E,4,0,"ng-template",null,0,i.C5r),i.k0s()(),i.j41(50,"div",5)(51,"div",29)(52,"label",30),i.EFF(53,"Mostrar:"),i.k0s(),i.j41(54,"select",31),i.mxI("ngModelChange",function(l){return i.eBV(a),i.DH7(e.itemsPerPage,l)||(e.itemsPerPage=l),i.Njj(l)}),i.bIt("change",function(){return i.eBV(a),i.Njj(e.currentPage=1)}),i.j41(55,"option",32),i.EFF(56,"10"),i.k0s(),i.j41(57,"option",32),i.EFF(58,"20"),i.k0s(),i.j41(59,"option",32),i.EFF(60,"40"),i.k0s()()(),i.DNE(61,N,11,8,"nav",33),i.k0s()()()()()()}if(2&n){const a=i.sdS(49);i.R7$(9),i.Y8G("routerLink",i.lJ4(18,p)),i.R7$(14),i.Lme("",e.notifications.length," notificaci\xf3n",1===e.notifications.length?"":"es",""),i.R7$(2),i.Y8G("ngIf",e.notifications.length>0),i.R7$(6),i.AVh("active","todas"===e.filterState),i.R7$(2),i.AVh("active","leidas"===e.filterState),i.R7$(2),i.AVh("active","no-leidas"===e.filterState),i.R7$(5),i.R50("ngModel",e.fechaOrden),i.R7$(7),i.Y8G("ngIf",e.notifications.length>0)("ngIfElse",a),i.R7$(7),i.R50("ngModel",e.itemsPerPage),i.R7$(),i.Y8G("value",10),i.R7$(2),i.Y8G("value",20),i.R7$(2),i.Y8G("value",40),i.R7$(2),i.Y8G("ngIf",e.totalPages>1)}},dependencies:[m.MD,m.YU,m.Sq,m.bT,u.iI,u.Wk,d.YN,d.xH,d.y7,d.wz,d.BC,d.vS],encapsulation:2})}return o})()}}]);