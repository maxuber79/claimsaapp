"use strict";(self.webpackChunkclaims_app=self.webpackChunkclaims_app||[]).push([[51],{3051:(j,u,c)=>{c.r(u),c.d(u,{AdminNotificationsComponent:()=>N});var m=c(2881),d=c(4341),g=c(5207),e=c(1360),f=c(7473),_=c(4796);const p=()=>["/dashboard"],h=(a,l,t,n,i)=>({"badge-full-danger":a,"badge-full-success":l,"badge-full-warning":t,"badge-full-primary":n,"badge-full-secondary":i});function b(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",37)(1,"button",38),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.markAllAsRead())}),e.nrm(2,"i",39),e.EFF(3," Marcar todas como le\xeddas "),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(),e.Y8G("disabled",t.allRead)}}function v(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",41)(1,"div",42)(2,"div")(3,"strong",43),e.EFF(4),e.k0s(),e.nrm(5,"br"),e.j41(6,"small",44),e.EFF(7),e.k0s(),e.EFF(8," | "),e.j41(9,"small",45),e.EFF(10),e.k0s()(),e.j41(11,"div",46)(12,"button",47),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.markAsRead(i))}),e.nrm(13,"i",48),e.EFF(14),e.k0s(),e.j41(15,"button",49),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.deleteNotification(i))}),e.nrm(16,"i",50),e.EFF(17," Eliminar "),e.k0s()()()()}if(2&a){const t=l.$implicit;e.R7$(3),e.Y8G("innerHTML",t.message,e.npT),e.R7$(),e.JRh(t.message),e.R7$(3),e.SpI("Le\xedda: ",t.read?"S\xed":"No",""),e.R7$(2),e.Y8G("ngClass",e.s1E(9,h,"urgente"===t.type,"asignado"===t.type,"editado"===t.type,"cerrado"===t.type,"admin-alert"===t.type)),e.R7$(),e.SpI(" ","asignado"===t.type?"Asignado":"urgente"===t.type?"Urgente":"editado"===t.type?"Editado":"admin-alert"===t.type?"Nueva Modificaci\xf3n":"cerrado"===t.type?"Cerrado":t.type," "),e.R7$(2),e.Y8G("ngClass",t.read?"btn-warning":"btn-full --success")("disabled",t.read),e.R7$(),e.Y8G("ngClass",t.read?"bi-check2-circle":"bi-check-lg"),e.R7$(),e.SpI(" ",t.read?"Notificaci\xf3n le\xedda":"Marcar como le\xedda"," ")}}function E(a,l){if(1&a&&(e.j41(0,"div"),e.DNE(1,v,18,15,"div",40),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.pagedNotifications)}}function F(a,l){1&a&&(e.j41(0,"div",1)(1,"div",5)(2,"div",51),e.EFF(3," No tienes notificaciones. "),e.k0s()()())}function k(a,l){if(1&a){const t=e.RV6();e.j41(0,"li",34)(1,"a",35),e.bIt("click",function(i){const o=e.eBV(t).$implicit;return e.XpG().onPageChange(o),e.Njj(i.preventDefault())}),e.EFF(2),e.k0s()()}if(2&a){const t=l.$implicit,n=e.XpG();e.AVh("active",t===n.currentPage),e.R7$(2),e.JRh(t)}}let N=(()=>{class a{notificationService;authService;uid="";notifications=[];filterState="todas";fechaOrden="desc";currentPage=1;itemsPerPage=10;constructor(t,n){this.notificationService=t,this.authService=n,console.log("\u{1f514} AdminNotifications inicializado")}ngOnInit(){this.authService.getAuthState().subscribe(t=>{t?(this.uid=t.uid,console.log("%c\u{1f50d} UID: "+this.uid,"background:#6610f2;color:#fff;padding:2px 5px;"),this.loadNotifications()):console.error("\u274c No hay usuario autenticado")})}loadNotifications(){this.notificationService.getUserNotifications(this.uid).subscribe({next:t=>{this.notifications=t??[],console.log("\u{1f514} Notificaciones del admin:",t),this.currentPage=Math.min(this.currentPage,this.totalPages)},error:t=>console.error("\u274c Error al cargar notificaciones:",t)})}asDate(t){return t?t instanceof Date?t:"number"==typeof t?new Date(t):t.toDate?t.toDate():new Date(t):new Date(0)}get filteredNotifications(){let t=[...this.notifications];return"leidas"===this.filterState?t=t.filter(n=>n.read):"no-leidas"===this.filterState&&(t=t.filter(n=>!n.read)),t.sort((n,i)=>{const o=this.asDate(n.timestamp).getTime(),r=this.asDate(i.timestamp).getTime();return"asc"===this.fechaOrden?o-r:r-o}),t}get totalItems(){return this.filteredNotifications.length}get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.itemsPerPage))}get pages(){return Array.from({length:this.totalPages},(t,n)=>n+1)}get pagedNotifications(){const t=(this.currentPage-1)*this.itemsPerPage;return this.filteredNotifications.slice(t,t+this.itemsPerPage)}onPageChange(t){t<1||t>this.totalPages||(this.currentPage=t)}onItemsPerPageChange(t){const n=Number(t.target.value);this.itemsPerPage=n,this.currentPage=1}markAsRead(t){t.read||!t.id||this.notificationService.markAsRead(this.uid,t.id).then(()=>{t.read=!0,console.log(`\u2705 Notificaci\xf3n ${t.id} marcada como le\xedda`)}).catch(n=>console.error("\u274c Error al marcar como le\xedda:",n))}deleteNotification(t){t.id&&this.notificationService.deleteNotification(this.uid,t.id).then(()=>{this.notifications=this.notifications.filter(n=>n.id!==t.id),console.log(`\u{1f5d1}\ufe0f Notificaci\xf3n ${t.id} eliminada`),(this.currentPage-1)*this.itemsPerPage>=this.totalItems&&(this.currentPage=Math.max(1,this.currentPage-1))}).catch(n=>console.error("\u274c Error al eliminar notificaci\xf3n:",n))}markAllAsRead(){this.notificationService.markAllAsRead(this.uid).then(()=>{this.notifications=this.notifications.map(t=>({...t,read:!0})),console.log("\u2705 Todas las notificaciones marcadas como le\xeddas.")}).catch(t=>console.error("\u274c Error al marcar todas como le\xeddas:",t))}get allRead(){return this.notifications.length>0&&this.notifications.every(t=>t.read)}badgeClass(t){switch(t){case"asignado":return"text-bg-warning";case"editado":return"text-bg-primary";case"cerrado":return"text-bg-success";case"urgente":return"text-bg-danger";case"admin-alert":return"text-bg-dark";default:return"text-bg-secondary"}}onFiltersChanged(){this.currentPage=1}static \u0275fac=function(n){return new(n||a)(e.rXU(f.J),e.rXU(_.u))};static \u0275cmp=e.VBU({type:a,selectors:[["app-admin-notifications"]],decls:74,vars:26,consts:[["noNotifs",""],[1,"row"],[1,"col-12","text-start","grid-margin"],[1,"card"],[1,"card-body"],[1,"col-12"],["aria-label","breadcrumb",1,""],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"col-12","grid-margin"],[1,"col-sm-12","col-md-7","d-flex","justify-content-start","align-items-center"],[1,"bi","bi-bell-fill","text-warning"],[1,"badge","badge-type","badge-outline-info"],[1,"col-sm-12","col-md-5","d-flex","justify-content-end","align-items-center"],["class","mb-3",4,"ngIf"],[1,"col-sm-12","col-md-12","d-flex","justify-content-between","align-items-center","mt-3"],[1,"py-3"],[1,"me-2","fw-semibold"],["role","group",1,"btn-group"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"form-select","form-select-sm","d-inline-block","w-auto",3,"ngModelChange","ngModel"],["value","desc"],["value","asc"],[1,"row","mt-4"],[4,"ngIf","ngIfElse"],[1,"col-12","d-flex","justify-content-between","align-items-center","mt-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"change","ngModel"],[3,"value"],["aria-label","Page navigation"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-full","--success","m-1",3,"click","disabled"],[1,"bi","bi-check2-all"],["class","list-group-item border my-2 p-3 rounded bg-light",4,"ngFor","ngForOf"],[1,"list-group-item","border","my-2","p-3","rounded","bg-light"],[1,"d-flex","justify-content-between","align-items-center"],[3,"innerHTML"],[1,"text-muted"],[1,"badge",3,"ngClass"],[1,"btn-group"],[1,"btn","m-1","btn-sm",3,"click","ngClass","disabled"],[1,"bi",3,"ngClass"],[1,"btn","btn-full","--danger","m-1","btn-sm",3,"click"],[1,"bi","bi-trash3-fill"],[1,"alert","alert-info","my-4"]],template:function(n,i){if(1&n){const o=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",1)(5,"div",5)(6,"nav",6)(7,"ol",7)(8,"li",8)(9,"a",9),e.EFF(10,"Home"),e.k0s()(),e.j41(11,"li",10),e.EFF(12,"Admin Notificaciones"),e.k0s()()()()()()()()(),e.j41(13,"div",1)(14,"div",11)(15,"div",3)(16,"div",4)(17,"div",1)(18,"div",12)(19,"h2"),e.nrm(20,"i",13),e.EFF(21," Notificaciones del Administrador "),e.j41(22,"small",14),e.EFF(23),e.k0s()()(),e.j41(24,"div",15),e.DNE(25,b,4,1,"div",16),e.k0s(),e.j41(26,"div",17)(27,"div",18)(28,"span",19),e.EFF(29,"Ordenar por estado:"),e.k0s(),e.j41(30,"div",20)(31,"button",21),e.bIt("click",function(){return e.eBV(o),i.filterState="todas",e.Njj(i.onFiltersChanged())}),e.EFF(32,"Todas"),e.k0s(),e.j41(33,"button",22),e.bIt("click",function(){return e.eBV(o),i.filterState="leidas",e.Njj(i.onFiltersChanged())}),e.EFF(34,"Le\xeddas"),e.k0s(),e.j41(35,"button",23),e.bIt("click",function(){return e.eBV(o),i.filterState="no-leidas",e.Njj(i.onFiltersChanged())}),e.EFF(36,"No le\xeddas"),e.k0s()()(),e.j41(37,"div",18)(38,"span",19),e.EFF(39,"Ordenar por fecha:"),e.k0s(),e.j41(40,"select",24),e.mxI("ngModelChange",function(s){return e.eBV(o),e.DH7(i.fechaOrden,s)||(i.fechaOrden=s),e.Njj(s)}),e.bIt("ngModelChange",function(){return e.eBV(o),e.Njj(i.onFiltersChanged())}),e.j41(41,"option",25),e.EFF(42,"M\xe1s reciente primero"),e.k0s(),e.j41(43,"option",26),e.EFF(44,"M\xe1s antigua primero"),e.k0s()()()(),e.j41(45,"div",5)(46,"div",27),e.DNE(47,E,2,1,"div",28)(48,F,4,0,"ng-template",null,0,e.C5r),e.k0s()(),e.j41(50,"div",5)(51,"div",29)(52,"div"),e.EFF(53," Elementos por p\xe1gina: "),e.j41(54,"select",30),e.bIt("change",function(s){return e.eBV(o),e.Njj(i.onItemsPerPageChange(s))}),e.j41(55,"option",31),e.EFF(56,"10"),e.k0s(),e.j41(57,"option",31),e.EFF(58,"25"),e.k0s(),e.j41(59,"option",31),e.EFF(60,"50"),e.k0s(),e.j41(61,"option",31),e.EFF(62,"100"),e.k0s()()(),e.j41(63,"nav",32)(64,"ul",33)(65,"li",34)(66,"a",35),e.bIt("click",function(s){return e.eBV(o),i.onPageChange(i.currentPage-1),e.Njj(s.preventDefault())}),e.EFF(67,"Anterior"),e.k0s()(),e.DNE(68,k,3,3,"li",36),e.j41(69,"li",34)(70,"a",35),e.bIt("click",function(s){return e.eBV(o),i.onPageChange(i.currentPage+1),e.Njj(s.preventDefault())}),e.EFF(71,"Siguiente"),e.k0s()()()(),e.j41(72,"div"),e.EFF(73),e.k0s()()()()()()()()}if(2&n){const o=e.sdS(49);e.R7$(9),e.Y8G("routerLink",e.lJ4(25,p)),e.R7$(14),e.Lme(" ",i.filteredNotifications.length," notificaci\xf3n",1===i.filteredNotifications.length?"":"es"," "),e.R7$(2),e.Y8G("ngIf",i.notifications.length>0),e.R7$(6),e.AVh("active","todas"===i.filterState),e.R7$(2),e.AVh("active","leidas"===i.filterState),e.R7$(2),e.AVh("active","no-leidas"===i.filterState),e.R7$(5),e.R50("ngModel",i.fechaOrden),e.R7$(7),e.Y8G("ngIf",i.filteredNotifications.length>0)("ngIfElse",o),e.R7$(7),e.Y8G("ngModel",i.itemsPerPage),e.R7$(),e.Y8G("value",10),e.R7$(2),e.Y8G("value",25),e.R7$(2),e.Y8G("value",50),e.R7$(2),e.Y8G("value",100),e.R7$(4),e.AVh("disabled",1===i.currentPage),e.R7$(3),e.Y8G("ngForOf",i.pages),e.R7$(),e.AVh("disabled",i.currentPage===i.totalPages),e.R7$(4),e.Lme(" P\xe1gina ",i.currentPage," de ",i.totalPages," ")}},dependencies:[m.MD,m.YU,m.Sq,m.bT,g.iI,g.Wk,d.YN,d.xH,d.y7,d.wz,d.BC,d.vS],encapsulation:2})}return a})()}}]);