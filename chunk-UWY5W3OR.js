import{a as $}from"./chunk-5Z7HKXYQ.js";import"./chunk-2BL6JQEY.js";import{a as H}from"./chunk-N6RA7QK6.js";import{d as W,g as z,l as B,m as q,n as G,q as J}from"./chunk-5RABQZIW.js";import"./chunk-3OADCOYV.js";import{$ as E,$a as D,Ba as b,Da as u,Ea as p,Fa as k,Ha as v,Ja as r,Ka as S,L as m,La as y,M as f,Ma as C,Na as A,Oa as V,Pa as M,Ta as I,Ya as T,a as x,b as P,ba as a,fa as N,ha as w,ib as F,jb as j,kb as O,la as h,mb as R,sa as d,ta as n,ua as o,va as _,vb as U,xb as L}from"./chunk-5TBBY7BX.js";var Q=()=>["/dashboard"],X=(s,e,t,i,l)=>({"badge-full-danger":s,"badge-full-success":e,"badge-full-warning":t,"badge-full-primary":i,"badge-full-secondary":l});function Y(s,e){if(s&1){let t=b();n(0,"div",40)(1,"button",41),u("click",function(){m(t);let l=p();return f(l.markAllAsRead())}),_(2,"i",42),r(3," Marcar todas como le\xEDdas "),o()()}if(s&2){let t=p();a(),d("disabled",t.allRead)}}function Z(s,e){if(s&1){let t=b();n(0,"div",44)(1,"div",1)(2,"div",45)(3,"strong",46),r(4),o(),_(5,"br"),n(6,"small",47),r(7),o(),r(8," | "),n(9,"small",48),r(10),o()(),n(11,"div",49)(12,"button",50),u("click",function(){let l=m(t).$implicit,c=p(2);return f(c.markAsRead(l))}),_(13,"i",51),r(14),o(),n(15,"button",52),u("click",function(){let l=m(t).$implicit,c=p(2);return f(c.deleteNotification(l))}),_(16,"i",53),r(17," Eliminar "),o()()()()}if(s&2){let t=e.$implicit;a(3),d("innerHTML",t.message,E),a(),S(t.message),a(3),y("Le\xEDda: ",t.read?"S\xED":"No"),a(2),d("ngClass",T(9,X,t.type==="urgente",t.type==="asignado",t.type==="editado",t.type==="cerrado",t.type==="admin-alert")),a(),y(" ",t.type==="asignado"?"Asignado":t.type==="urgente"?"Urgente":t.type==="editado"?"Editado":t.type==="admin-alert"?"Nueva Modificaci\xF3n":t.type==="cerrado"?"Cerrado":t.type," "),a(2),d("ngClass",t.read?"btn-full --warning":"btn-full --success")("disabled",t.read),a(),d("ngClass",t.read?"bi-check2-circle":"bi-check-lg"),a(),y(" ",t.read?"Notificaci\xF3n le\xEDda":"Marcar como le\xEDda"," ")}}function ee(s,e){if(s&1&&(n(0,"div"),h(1,Z,18,15,"div",43),o()),s&2){let t=p();a(),d("ngForOf",t.pagedNotifications)}}function te(s,e){s&1&&(n(0,"div",1)(1,"div",5)(2,"div",54),r(3," No tienes notificaciones. "),o()()())}function ie(s,e){if(s&1){let t=b();n(0,"li",36)(1,"a",37),u("click",function(l){let c=m(t).$implicit;return p().onPageChange(c),f(l.preventDefault())}),r(2),o()()}if(s&2){let t=e.$implicit,i=p();v("active",t===i.currentPage),a(2),S(t)}}var K=class s{constructor(e,t){this.notificationService=e;this.authService=t;console.log("\u{1F514} AdminNotifications inicializado")}uid="";notifications=[];filterState="todas";fechaOrden="desc";currentPage=1;itemsPerPage=10;ngOnInit(){this.authService.getAuthState().subscribe(e=>{if(!e){console.error("\u274C No hay usuario autenticado");return}this.uid=e.uid,console.log("%c\u{1F50D} UID: "+this.uid,"background:#6610f2;color:#fff;padding:2px 5px;"),this.loadNotifications()})}loadNotifications(){this.notificationService.getUserNotifications(this.uid).subscribe({next:e=>{this.notifications=e??[],console.log("\u{1F514} Notificaciones del admin:",e),this.currentPage=Math.min(this.currentPage,this.totalPages)},error:e=>console.error("\u274C Error al cargar notificaciones:",e)})}asDate(e){return e?e instanceof Date?e:typeof e=="number"?new Date(e):e.toDate?e.toDate():new Date(e):new Date(0)}get filteredNotifications(){let e=[...this.notifications];return this.filterState==="leidas"?e=e.filter(t=>t.read):this.filterState==="no-leidas"&&(e=e.filter(t=>!t.read)),e.sort((t,i)=>{let l=this.asDate(t.timestamp).getTime(),c=this.asDate(i.timestamp).getTime();return this.fechaOrden==="asc"?l-c:c-l}),e}get totalItems(){return this.filteredNotifications.length}get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.itemsPerPage))}get pages(){return Array.from({length:this.totalPages},(e,t)=>t+1)}get pagedNotifications(){let e=(this.currentPage-1)*this.itemsPerPage;return this.filteredNotifications.slice(e,e+this.itemsPerPage)}onPageChange(e){e<1||e>this.totalPages||(this.currentPage=e)}onItemsPerPageChange(e){let t=Number(e.target.value);this.itemsPerPage=t,this.currentPage=1}markAsRead(e){e.read||!e.id||this.notificationService.markAsRead(this.uid,e.id).then(()=>{e.read=!0,console.log(`\u2705 Notificaci\xF3n ${e.id} marcada como le\xEDda`)}).catch(t=>console.error("\u274C Error al marcar como le\xEDda:",t))}deleteNotification(e){e.id&&this.notificationService.deleteNotification(this.uid,e.id).then(()=>{this.notifications=this.notifications.filter(t=>t.id!==e.id),console.log(`\u{1F5D1}\uFE0F Notificaci\xF3n ${e.id} eliminada`),(this.currentPage-1)*this.itemsPerPage>=this.totalItems&&(this.currentPage=Math.max(1,this.currentPage-1))}).catch(t=>console.error("\u274C Error al eliminar notificaci\xF3n:",t))}markAllAsRead(){this.notificationService.markAllAsRead(this.uid).then(()=>{this.notifications=this.notifications.map(e=>P(x({},e),{read:!0})),console.log("\u2705 Todas las notificaciones marcadas como le\xEDdas.")}).catch(e=>console.error("\u274C Error al marcar todas como le\xEDdas:",e))}get allRead(){return this.notifications.length>0&&this.notifications.every(e=>e.read)}badgeClass(e){switch(e){case"asignado":return"text-bg-warning";case"editado":return"text-bg-primary";case"cerrado":return"text-bg-success";case"urgente":return"text-bg-danger";case"admin-alert":return"text-bg-dark";default:return"text-bg-secondary"}}onFiltersChanged(){this.currentPage=1}static \u0275fac=function(t){return new(t||s)(N($),N(H))};static \u0275cmp=w({type:s,selectors:[["app-admin-notifications"]],decls:73,vars:26,consts:[["noNotifs",""],[1,"row"],[1,"col-12","text-start","grid-margin"],[1,"card"],[1,"card-body"],[1,"col-12"],["aria-label","breadcrumb",1,""],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"col-12","grid-margin"],[1,"col-12","col-md-6","d-flex","justify-content-center","justify-content-md-start","align-items-center","py-2"],[1,"bi","bi-bell-fill","text-warning"],[1,"badge","badge-type","badge-outline-info"],[1,"col-12","col-md-6","d-flex","justify-content-center","justify-content-md-end","align-items-center","py-2"],["class","mb-3",4,"ngIf"],[1,"col-12","col-md-6","d-flex","justify-content-center","justify-content-md-start","align-items-center","py-3"],[1,"d-inline-block","text-center"],[1,"me-2","fw-semibold"],["role","group",1,"btn-group"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"col-12","col-md-6","d-flex","justify-content-center","justify-content-md-end","align-items-center","py-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto",3,"ngModelChange","ngModel"],["value","desc"],["value","asc"],[1,"col-sm-12","col-md-12"],[4,"ngIf","ngIfElse"],[1,"col-12","col-md-4","d-flex","justify-content-center","justify-content-md-start","align-items-center","py-2"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"change","ngModel"],[3,"value"],[1,"col-12","col-md-4","d-flex","justify-content-center","justify-content-md-center","align-items-center","py-2"],["aria-label","Page navigation",1,"overflow-auto"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"col-12","col-md-4","d-flex","justify-content-center","justify-content-md-end","align-items-center","py-2"],[1,"mb-3"],[1,"btn","btn-full","--success","my-2",3,"click","disabled"],[1,"bi","bi-check2-all"],["class","list-group-item border my-2 p-3 rounded bg-light",4,"ngFor","ngForOf"],[1,"list-group-item","border","my-2","p-3","rounded","bg-light"],[1,"col-sm-12","col-md-6","py-2"],[3,"innerHTML"],[1,"text-muted"],[1,"badge",3,"ngClass"],[1,"d-block","col-md-6","py-2","d-md-flex","justify-content-md-end","align-items-md-center"],[1,"btn","m-1","btn-sm",3,"click","ngClass","disabled"],[1,"bi",3,"ngClass"],[1,"btn","btn-full","--danger","m-1","btn-sm",3,"click"],[1,"bi","bi-trash3-fill"],[1,"alert","alert-info","my-4"]],template:function(t,i){if(t&1){let l=b();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",1)(5,"div",5)(6,"nav",6)(7,"ol",7)(8,"li",8)(9,"a",9),r(10,"Home"),o()(),n(11,"li",10),r(12,"Admin Notificaciones"),o()()()()()()()()(),n(13,"div",1)(14,"div",11)(15,"div",3)(16,"div",4)(17,"div",1)(18,"div",12)(19,"h2"),_(20,"i",13),r(21," Notificaciones del Administrador "),n(22,"small",14),r(23),o()()(),n(24,"div",15),h(25,Y,4,1,"div",16),o(),n(26,"div",17)(27,"div",18)(28,"span",19),r(29,"Ordenar por estado:"),o(),n(30,"div",20)(31,"button",21),u("click",function(){return m(l),i.filterState="todas",f(i.onFiltersChanged())}),r(32,"Todas"),o(),n(33,"button",22),u("click",function(){return m(l),i.filterState="leidas",f(i.onFiltersChanged())}),r(34,"Le\xEDdas"),o(),n(35,"button",23),u("click",function(){return m(l),i.filterState="no-leidas",f(i.onFiltersChanged())}),r(36,"No le\xEDdas"),o()()()(),n(37,"div",24)(38,"div",18)(39,"span",19),r(40,"Ordenar por fecha:"),o(),n(41,"select",25),M("ngModelChange",function(g){return m(l),V(i.fechaOrden,g)||(i.fechaOrden=g),f(g)}),u("ngModelChange",function(){return m(l),f(i.onFiltersChanged())}),n(42,"option",26),r(43,"M\xE1s reciente primero"),o(),n(44,"option",27),r(45,"M\xE1s antigua primero"),o()()()(),n(46,"div",28),h(47,ee,2,1,"div",29)(48,te,4,0,"ng-template",null,0,D),o(),n(50,"div",30),r(51," Elementos por p\xE1gina: "),n(52,"select",31),u("change",function(g){return m(l),f(i.onItemsPerPageChange(g))}),n(53,"option",32),r(54,"10"),o(),n(55,"option",32),r(56,"25"),o(),n(57,"option",32),r(58,"50"),o(),n(59,"option",32),r(60,"100"),o()()(),n(61,"div",33)(62,"nav",34)(63,"ul",35)(64,"li",36)(65,"a",37),u("click",function(g){return m(l),i.onPageChange(i.currentPage-1),f(g.preventDefault())}),r(66,"Anterior"),o()(),h(67,ie,3,3,"li",38),n(68,"li",36)(69,"a",37),u("click",function(g){return m(l),i.onPageChange(i.currentPage+1),f(g.preventDefault())}),r(70,"Siguiente"),o()()()()(),n(71,"div",39),r(72),o()()()()()()}if(t&2){let l=k(49);a(9),d("routerLink",I(25,Q)),a(14),C(" ",i.filteredNotifications.length," notificaci\xF3n",i.filteredNotifications.length===1?"":"es"," "),a(2),d("ngIf",i.notifications.length>0),a(6),v("active",i.filterState==="todas"),a(2),v("active",i.filterState==="leidas"),a(2),v("active",i.filterState==="no-leidas"),a(6),A("ngModel",i.fechaOrden),a(6),d("ngIf",i.filteredNotifications.length>0)("ngIfElse",l),a(5),d("ngModel",i.itemsPerPage),a(),d("value",10),a(2),d("value",25),a(2),d("value",50),a(2),d("value",100),a(5),v("disabled",i.currentPage===1),a(3),d("ngForOf",i.pages),a(),v("disabled",i.currentPage===i.totalPages),a(4),C(" P\xE1gina ",i.currentPage," de ",i.totalPages," ")}},dependencies:[R,F,j,O,L,U,J,q,G,B,W,z],encapsulation:2})};export{K as AdminNotificationsComponent};
