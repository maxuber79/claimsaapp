import{a as g,c as d,d as f,e as h,f as u,g as v,h as N,j as w,l as y,m as a,r as b,s as l,v as $}from"./chunk-2BL6JQEY.js";import{D as m,H as p,g as s}from"./chunk-5TBBY7BX.js";var U=class c{firestore=p(N);constructor(){console.log("%c<<< Start NOTIFICATION service >>>","background: #fff3cd; color: #664d03; padding: 2px 5px;")}sendToUser(i,o,r){return s(this,null,function*(){try{let e={message:o,type:r,timestamp:g.now(),read:!1},t=a(this.firestore,`users/${i}/notifications`),n=yield y(t,e);console.log("\u2705 Notificaci\xF3n enviada:",{uid:i,message:o,docId:n.id})}catch(e){throw console.error("\u274C Error al enviar notificaci\xF3n:",e),e}})}sendToAdmins(i,o){return s(this,null,function*(){try{let r=a(this.firestore,"users"),e=l(r,$("rol","==","Administrador")),t=yield f(e);if(t.empty){console.warn("\u26A0\uFE0F No se encontraron administradores para notificar");return}let n=[];t.forEach(P=>{let R=P.id;n.push(this.sendToUser(R,i,o))}),yield Promise.all(n),console.log(`\u2705 Notificaci\xF3n enviada a ${t.size} administradores`)}catch(r){console.error("\u274C Error al enviar notificaci\xF3n a administradores:",r)}})}getUserNotifications(i){let o=a(this.firestore,`users/${i}/notifications`),r=l(o,b("timestamp","desc"));return w(r,{idField:"id"})}markAsRead(i,o){return s(this,null,function*(){try{let r=d(this.firestore,`users/${i}/notifications/${o}`);yield h(r,{read:!0}),console.log("\u2705 Notificaci\xF3n marcada como le\xEDda:",o)}catch(r){console.error("\u274C Error al marcar notificaci\xF3n como le\xEDda:",r)}})}markAllAsRead(i){return s(this,null,function*(){let o=a(this.firestore,`users/${i}/notifications`),r=yield f(o),e=v(this.firestore);r.forEach(t=>{t.data().read||e.update(t.ref,{read:!0})}),yield e.commit(),console.log(`\u2705 Todas las notificaciones del usuario ${i} marcadas como le\xEDdas.`)})}deleteNotification(i,o){let r=d(this.firestore,`users/${i}/notifications/${o}`);return u(r).then(()=>console.log(`\u{1F9F9} Notificaci\xF3n ${o} eliminada de Firestore`)).catch(e=>console.error("\u274C Error al eliminar notificaci\xF3n:",e))}static \u0275fac=function(o){return new(o||c)};static \u0275prov=m({token:c,factory:c.\u0275fac,providedIn:"root"})};export{U as a};
