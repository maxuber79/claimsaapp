"use strict";(self.webpackChunkclaims_app=self.webpackChunkclaims_app||[]).push([[69],{2419:(G,j,l)=>{l.d(j,{B:()=>_});var m=l(9967),c=l(3273),r=l(8455),g=l(5558),x=l(6354),e=l(1360),f=l(4796),F=l(9885);let _=(()=>{class C{firestore;authService;userService;constructor(h,p,v){this.firestore=h,this.authService=p,this.userService=v,console.log("%c<<< Start CLAIMS service >>>","background: #fff3cd; color: #664d03; padding: 2px 5px;")}createClaim(h,p){const v=p.id||(0,m.H9)((0,c.rJ)(this.firestore,`users/${h}/claims`)).id,E=(0,m.H9)(this.firestore,`users/${h}/claims/${v}`);return(0,m.BN)(E,{...p,id:v})}updateClaim(h,p){const v=(0,m.H9)(this.firestore,`users/${h}/claims/${p.id}`);return(0,m.mZ)(v,{...p})}deleteClaim(h,p){const v=(0,m.H9)(this.firestore,`users/${h}/claims/${p}`);return(0,m.kd)(v)}getUserClaims(h){const p=(0,m.rJ)(this.firestore,`users/${h}/claims`);return(0,m.xs)(p,{idField:"id"})}getAllClaims(){const h=(0,m.rJ)(this.firestore,"users");return console.log("\u{1f50d} Buscando todos los reclamos de todos los ejecutivos...",h),(0,r.H)((0,c.GG)(h)).pipe((0,g.n)(p=>{const v=p.docs.map(E=>{const k=E.id,T=(0,m.rJ)(this.firestore,`users/${k}/claims`);return(0,c.GG)(T).then(R=>R.docs.map(I=>({...I.data(),uidEjecutivo:k})))});return(0,r.H)(Promise.all(v))}),(0,x.T)(p=>p.flat()))}getClaimsByUid(h){const p=(0,m.rJ)(this.firestore,`users/${h}/claims`);return(0,r.H)((0,c.GG)(p)).pipe((0,x.T)(v=>v.docs.map(E=>({...E.data(),uidEjecutivo:h,id:E.id}))))}static \u0275fac=function(p){return new(p||C)(e.KVO(m._7),e.KVO(f.u),e.KVO(F.D))};static \u0275prov=e.jDH({token:C,factory:C.\u0275fac,providedIn:"root"})}return C})()},4927:(G,j,l)=>{l.d(j,{_:()=>e});var m=l(2881),c=l(1360),r=l(2419);function g(f,F){if(1&f&&c.nrm(0,"i"),2&f){const _=c.XpG();c.ZvI("bi ",_.trendIconLeft,"")}}function x(f,F){if(1&f&&c.nrm(0,"i"),2&f){const _=c.XpG();c.ZvI("bi ",_.trendIcon," text-white")}}let e=(()=>{class f{claimsService;icon="";count="";label="";color="primary";constructor(_){this.claimsService=_}ngOnInit(){}footerText;trendIcon;trendIconLeft;static \u0275fac=function(C){return new(C||f)(c.rXU(r.B))};static \u0275cmp=c.VBU({type:f,selectors:[["app-card-metric"]],inputs:{icon:"icon",count:"count",label:"label",color:"color",footerText:"footerText",trendIcon:"trendIcon",trendIconLeft:"trendIconLeft"},decls:15,vars:13,consts:[[1,"card","h-100","shadow-sm"],[1,"card-body","d-flex","justify-content-between","align-items-center","p-4"],[1,"d-flex","align-items-center","gap-3"],[1,"card-text","text-muted","m-0","f-size-3"],[1,"card-footer","d-flex","justify-content-between","align-items-center","py-2","px-3",3,"ngClass"],[1,"d-flex","align-items-center","gap-2","text-white"],[3,"class",4,"ngIf"]],template:function(C,b){1&C&&(c.j41(0,"div",0)(1,"div",1)(2,"div",2),c.nrm(3,"i"),c.j41(4,"div")(5,"h3"),c.EFF(6),c.k0s(),c.j41(7,"p",3),c.EFF(8),c.k0s()()()(),c.j41(9,"div",4)(10,"div",5),c.DNE(11,g,1,3,"i",6),c.j41(12,"small"),c.EFF(13),c.k0s()(),c.DNE(14,x,1,3,"i",6),c.k0s()()),2&C&&(c.R7$(3),c.STu("bi ",b.icon," f-size-20 text-",b.color,""),c.R7$(2),c.ZvI("card-title m-0 fw-bold text-",b.color,""),c.R7$(),c.JRh(b.count),c.R7$(2),c.JRh(b.label),c.R7$(),c.Y8G("ngClass","bg-"+b.color),c.R7$(2),c.Y8G("ngIf",b.trendIconLeft),c.R7$(2),c.JRh(b.footerText),c.R7$(),c.Y8G("ngIf",b.trendIcon))},dependencies:[m.MD,m.YU,m.bT],styles:[".card-extended[_ngcontent-%COMP%]{transition:transform .2s ease;border-radius:1rem}.card-extended[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.card-extended[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500;min-height:40px;color:#fff!important}"]})}return f})()},9069:(G,j,l)=>{l.r(j),l.d(j,{routes:()=>we});var m=l(467),c=l(5207),r=l(4341),g=l(2881),x=l(4843),e=l(1360),f=l(6810),F=l(9332),_=l(4796),C=l(5072);const b=(n,a)=>({"bg-success-subtle":n,"":a}),h=n=>({"fw-bold":!0,"completed-text":n}),p=n=>({"completed-text":n}),v=(n,a,t)=>({"text-bg-danger":n,"text-bg-warning":a,"text-bg-secondary":t}),E=(n,a)=>({"bg-success":n,"bg-danger":a}),k=(n,a)=>({"btn-warning":n,"btn-outline-success":a});function T(n,a){1&n&&(e.j41(0,"div",29),e.EFF(1," El t\xedtulo es obligatorio. "),e.k0s())}function R(n,a){1&n&&e.nrm(0,"i",45)}function I(n,a){if(1&n){const t=e.RV6();e.j41(0,"li",30)(1,"div",31)(2,"div",32),e.DNE(3,R,1,0,"i",33),e.EFF(4),e.k0s(),e.j41(5,"small",34),e.EFF(6),e.k0s(),e.nrm(7,"br"),e.j41(8,"span",35),e.EFF(9),e.k0s(),e.j41(10,"span",36),e.EFF(11),e.nI1(12,"date"),e.k0s(),e.j41(13,"span",37),e.EFF(14),e.k0s()(),e.j41(15,"div",38)(16,"span",39),e.EFF(17),e.k0s(),e.j41(18,"button",40),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.deleteTodo(i.id))}),e.nrm(19,"i",24),e.EFF(20," Eliminar "),e.k0s(),e.j41(21,"button",41),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.toggleComplete(i))}),e.nrm(22,"i",42),e.EFF(23),e.k0s(),e.j41(24,"button",43),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.editTodo(i.id))}),e.nrm(25,"i",44),e.EFF(26," Editar "),e.k0s()()()}if(2&n){const t=a.$implicit;e.Y8G("ngClass",e.l_i(17,b,t.completed,!t.completed)),e.R7$(2),e.Y8G("ngClass",e.eq3(20,h,t.completed)),e.R7$(),e.Y8G("ngIf",t.completed),e.R7$(),e.JRh(t.title),e.R7$(),e.Y8G("ngClass",e.eq3(22,p,t.completed)),e.R7$(),e.JRh(t.description),e.R7$(2),e.Y8G("ngClass",e.sMw(24,v,"high"===t.priority,"medium"===t.priority,"low"===t.priority)),e.R7$(),e.JRh("high"===t.priority?"Alta":"medium"===t.priority?"Media":"low"===t.priority?"Baja":"Desconocida"),e.R7$(2),e.JRh(e.i5U(12,14,t.dueDate,"shortDate")),e.R7$(3),e.JRh(t.id),e.R7$(2),e.Y8G("ngClass",e.l_i(28,E,t.completed,!t.completed)),e.R7$(),e.SpI(" ",t.completed?"Completada":"Pendiente"," "),e.R7$(4),e.Y8G("ngClass",e.l_i(31,k,t.completed,!t.completed)),e.R7$(2),e.SpI(" ",t.completed?"Desmarcar":"Completar"," ")}}let A=(()=>{class n{todoService;alertService;fb;authService;route;router;todoForm;todos=[];otraCondicion=!0;condicion=!0;constructor(t,o,i,s,d,u){this.todoService=t,this.alertService=o,this.fb=i,this.authService=s,this.route=d,this.router=u,console.log("%c<<< Constructor TODO-LIST >>>","background: #fff3cd; color: #664d03; padding: 2px 5px;"),this.todoForm=this.fb.group({title:["",[r.k0.required,r.k0.minLength(3)]],description:[""],dueDate:[null],priority:["",r.k0.required]})}ngOnInit(){var t=this;return(0,m.A)(function*(){console.log("%c<<< ngOnInit TODO-LIST >>>","background: #6610f2; color: #ffffff; padding: 2px 5px;");const o=yield(0,x._)(t.authService.getCurrentUser());if(!o||!o.uid)return t.alertService.error("Usuario no autenticado"),void console.error("\u274c Usuario no autenticado");console.log("\u{1f7e2} Usuario autenticado:",o.uid),t.todoService.getTodos().subscribe(i=>{t.todos=i,console.log("\u{1f4cb} Tareas recibidas:",t.todos)})})()}onSubmit(){var t=this;return(0,m.A)(function*(){if(t.todoForm.invalid)return t.todoForm.markAllAsTouched(),void t.alertService.warning("Por favor, completa todos los campos requeridos.");const o=t.todoForm.value;console.log("%c\u{1f4e4} Enviando tarea a Firestore:","color: #0d6efd",o);try{console.log("\u{1f4e4} Enviando tarea al servicio TodoService..."),yield t.todoService.addTodo({title:o.title,description:o.description,dueDate:o.dueDate,priority:o.priority}),t.alertService.success("Tu tarea fue guardada correctamente"),console.log("%c\u2705 Tarea guardada con \xe9xito","color: #198754"),t.todoForm.reset()}catch(i){t.alertService.error("Ocurri\xf3 un error al guardar la tarea"),console.error("%c\u274c Error al guardar tarea:","color: red",i?.message??i)}})()}deleteTodo(t){var o=this;return(0,m.A)(function*(){if((yield o.alertService.confirm("\xbfDeseas eliminar esta tarea?")).isConfirmed)try{yield o.todoService.deleteTodo(t),o.alertService.success("Tarea eliminada correctamente")}catch(s){console.error("\u274c Error al eliminar tarea:",s),o.alertService.error("No se pudo eliminar la tarea")}})()}toggleComplete(t){var o=this;return(0,m.A)(function*(){try{const i=!t.completed;yield o.todoService.updateTodo(t.id,{completed:i}),i?o.alertService.showToastSuccess("Marcado como completado","\xc9xito"):o.alertService.showToastWarning("Marcado como pendiente","Atenci\xf3n")}catch(i){o.alertService.showToastError("No se pudo actualizar el estado","Error"),console.error(i)}})()}clearAll(){var t=this;return(0,m.A)(function*(){if((yield t.alertService.confirm("\xbfEliminar todas las tareas?")).isConfirmed)try{yield t.todoService.clearAllTodos(),t.alertService.success("Todas las tareas fueron eliminadas")}catch(i){console.error("\u274c Error al limpiar tareas:",i),t.alertService.error("No se pudieron eliminar las tareas")}})()}editTodo(t){this.router.navigate(["/dashboard/todo-list/todo-edit/",t])}testAlert(){this.alertService.showToastSuccess("\xa1Todo sali\xf3 bien!","\xc9xito"),console.log("%c\u2139\ufe0f Alerta de informaci\xf3n mostrada","color: #0dcaf0")}static \u0275fac=function(o){return new(o||n)(e.rXU(f.y),e.rXU(F.u),e.rXU(r.ok),e.rXU(_.u),e.rXU(C.nX),e.rXU(C.Ix))};static \u0275cmp=e.VBU({type:n,selectors:[["app-todo-list"]],decls:49,vars:6,consts:[[1,"row"],[1,"col-12"],[1,"my-4"],[1,"col-12","border","p-3","mb-5","bg-light","rounded-1"],[1,"row","g-3",3,"ngSubmit","formGroup"],[1,"col-md-6"],["for","title",1,"form-label"],["type","text","formControlName","title","id","title",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","description",1,"form-label"],["type","text","formControlName","description","id","description",1,"form-control"],["for","dueDate",1,"form-label"],["type","date","formControlName","dueDate","id","dueDate",1,"form-control"],["for","priority",1,"form-label"],["formControlName","priority","id","priority",1,"form-select"],["value","","disabled",""],["value","low"],["value","medium"],["value","high"],[1,"col-12","text-end"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"mb-3"],[1,"col-12","p-3","text-end"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-trash3-fill"],[1,"btn","btn-success","mx-2",3,"click"],[1,"bi","bi-bell-fill"],[1,"list-group"],["class","list-group-item d-flex flex-wrap flex-md-nowrap justify-content-between align-items-center align-items-md-center gap-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"invalid-feedback"],[1,"list-group-item","d-flex","flex-wrap","flex-md-nowrap","justify-content-between","align-items-center","align-items-md-center","gap-3",3,"ngClass"],[1,"text-start","flex-grow-1","me-3","todo-content"],[1,"fw-bold",3,"ngClass"],["class","bi bi-check-circle-fill text-success me-1",4,"ngIf"],[1,"text-muted",3,"ngClass"],[1,"badge","me-2",3,"ngClass"],[1,"badge","text-bg-light","text-dark"],[1,"badge","text-bg-primary","ms-2"],[1,"d-flex","flex-wrap","align-items-center","justify-content-end","gap-2","todo-actions"],[1,"badge",3,"ngClass"],[1,"btn","btn-sm","btn-outline-danger","ms-2",3,"click"],[1,"btn","btn-sm","ms-2",3,"click","ngClass"],[1,"bi","bi-check"],[1,"btn","btn-sm","btn-outline-primary","ms-2",3,"click"],[1,"bi","bi-pencil-square"],[1,"bi","bi-check-circle-fill","text-success","me-1"]],template:function(o,i){if(1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.EFF(3,"Agregar nueva tarea"),e.k0s()(),e.j41(4,"div",3)(5,"form",4),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(6,"div",5)(7,"label",6),e.EFF(8,"T\xedtulo"),e.k0s(),e.nrm(9,"input",7),e.DNE(10,T,2,0,"div",8),e.k0s(),e.j41(11,"div",5)(12,"label",9),e.EFF(13,"Descripci\xf3n"),e.k0s(),e.nrm(14,"input",10),e.k0s(),e.j41(15,"div",5)(16,"label",11),e.EFF(17,"Fecha l\xedmite"),e.k0s(),e.nrm(18,"input",12),e.k0s(),e.j41(19,"div",5)(20,"label",13),e.EFF(21,"Prioridad"),e.k0s(),e.j41(22,"select",14)(23,"option",15),e.EFF(24,"Selecciona prioridad"),e.k0s(),e.j41(25,"option",16),e.EFF(26,"Baja"),e.k0s(),e.j41(27,"option",17),e.EFF(28,"Media"),e.k0s(),e.j41(29,"option",18),e.EFF(30,"Alta"),e.k0s()()(),e.j41(31,"div",19)(32,"button",20),e.EFF(33,"Guardar tarea"),e.k0s()()()()(),e.nrm(34,"hr",2),e.j41(35,"div",0)(36,"div",1)(37,"h2",21),e.EFF(38,"Tareas registradas"),e.k0s()(),e.j41(39,"div",22)(40,"button",23),e.bIt("click",function(){return i.clearAll()}),e.nrm(41,"i",24),e.EFF(42," Eliminar todas las tareas "),e.k0s(),e.j41(43,"button",25),e.bIt("click",function(){return i.testAlert()}),e.nrm(44,"i",26),e.EFF(45," prueba de alert toast "),e.k0s()(),e.j41(46,"div",1)(47,"ul",27),e.DNE(48,I,27,34,"li",28),e.k0s()()()),2&o){let s,d;e.R7$(5),e.Y8G("formGroup",i.todoForm),e.R7$(4),e.AVh("is-invalid",(null==(s=i.todoForm.get("title"))?null:s.invalid)&&(null==(s=i.todoForm.get("title"))?null:s.touched)),e.R7$(),e.Y8G("ngIf",(null==(d=i.todoForm.get("title"))?null:d.invalid)&&(null==(d=i.todoForm.get("title"))?null:d.touched)),e.R7$(22),e.Y8G("disabled",i.todoForm.invalid),e.R7$(16),e.Y8G("ngForOf",i.todos)}},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.vh,r.YN,r.qT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.X1,r.j4,r.JD,c.iI],styles:['@charset "UTF-8";.completed-text[_ngcontent-%COMP%]{color:#6c757d;text-decoration:line-through;transition:color .3s ease,-webkit-text-decoration .3s ease;transition:color .3s ease,text-decoration .3s ease;transition:color .3s ease,text-decoration .3s ease,-webkit-text-decoration .3s ease}.todo-content[_ngcontent-%COMP%]{min-width:0}.todo-actions[_ngcontent-%COMP%]{flex-shrink:0;white-space:nowrap}@media (max-width: 768px){.todo-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;width:100%}.todo-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}']})}return n})();var w=l(8359),S=l(4927),N=l(2419),y=l(9885),P=l(7473);const U=(n,a,t,o)=>({"bg-primary":n,"bg-warning text-dark":a,"bg-danger":t,"bg-success":o});function V(n,a){1&n&&(e.j41(0,"div",11)(1,"div",12)(2,"span",13),e.EFF(3,"Loading..."),e.k0s()()())}function B(n,a){if(1&n&&(e.j41(0,"div")(1,"div",6)(2,"div",7)(3,"div",14)(4,"div",15),e.nrm(5,"img",16),e.k0s(),e.j41(6,"div",17)(7,"h2",18),e.EFF(8),e.k0s(),e.j41(9,"h6",18),e.EFF(10,"Bienvenido a tu aplicaci\xf3n"),e.k0s(),e.j41(11,"p",19),e.EFF(12,"Este es tu panel de control, aqu\xed puedes administrar tus tareas, ver estad\xedsticas y m\xe1s."),e.k0s(),e.j41(13,"p",19)(14,"span",20),e.EFF(15),e.k0s()()()()()()()),2&n){const t=e.XpG();e.R7$(5),e.Y8G("src",t.userData.photoURL||t.imageDefault,e.B4B),e.R7$(3),e.SpI("Hola, ",t.userData.name||"Invitado",""),e.R7$(7),e.JRh(t.userData.rol||"Desconocido")}}function Y(n,a){if(1&n&&(e.j41(0,"div",21),e.nrm(1,"app-card-metric",22),e.k0s()),2&n){const t=a.$implicit;e.R7$(),e.Y8G("icon",t.icon)("count",t.count)("label",t.label)("color",t.color)("footerText",t.footerText)("trendIcon",t.trendIcon)}}function X(n,a){1&n&&(e.j41(0,"div",11)(1,"div",12)(2,"span",13),e.EFF(3,"Cargando..."),e.k0s()()())}function O(n,a){if(1&n&&(e.j41(0,"div",23)(1,"div",24),e.EFF(2),e.k0s()()),2&n){const t=e.XpG();e.R7$(2),e.SpI(" ",t.errorMessage," ")}}function L(n,a){if(1&n&&(e.j41(0,"option",57),e.EFF(1),e.k0s()),2&n){const t=a.$implicit;e.Y8G("value",t.uid),e.R7$(),e.Lme(" ",t.name," ",t.last_name," ")}}function H(n,a){1&n&&(e.j41(0,"tr")(1,"td",65),e.EFF(2,"No se encontraron reclamos con los filtros aplicados."),e.k0s()())}function z(n,a){if(1&n){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"input",53),e.bIt("change",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.toggleClaimSelection(i))}),e.k0s()(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"date"),e.k0s(),e.j41(10,"td")(11,"span",66),e.EFF(12),e.k0s()(),e.j41(13,"td"),e.EFF(14),e.k0s(),e.j41(15,"td")(16,"button",67),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.openViewEditModal(i,!0))}),e.nrm(17,"i",68),e.EFF(18," Ver/Editar "),e.k0s()()()}if(2&n){const t=a.$implicit,o=e.XpG(2);e.R7$(2),e.Y8G("checked",t.selected),e.R7$(2),e.JRh(t.nombre),e.R7$(2),e.JRh(t.tipo),e.R7$(2),e.JRh(e.i5U(9,7,t.fecha,"shortDate")),e.R7$(3),e.Y8G("ngClass",e.ziG(10,U,"Iniciado"===t.estado,"Pendiente"===t.estado,"Cancelado"===t.estado,"Cerrado"===t.estado)),e.R7$(),e.SpI(" ",t.estado," "),e.R7$(2),e.SpI(" ",o.getExecutiveName(t.uidEjecutivo)," ")}}function J(n,a){if(1&n){const t=e.RV6();e.j41(0,"li",62)(1,"a",63),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.onPageChange(i))}),e.EFF(2),e.k0s()()}if(2&n){const t=a.$implicit,o=e.XpG(2);e.AVh("active",t===o.currentPage),e.R7$(2),e.JRh(t)}}function K(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",0)(1,"div",25)(2,"h2",26),e.EFF(3,"Administraci\xf3n de Reclamaciones"),e.k0s(),e.j41(4,"p",27),e.EFF(5,"Aqu\xed puedes gestionar todas las reclamaciones de los usuarios."),e.k0s()(),e.j41(6,"div",28)(7,"button",29),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openNewModal())}),e.nrm(8,"i",30),e.EFF(9," Nuevo Reclamo "),e.k0s(),e.j41(10,"button",31),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.deleteSelectedClaims())}),e.nrm(11,"i",32),e.EFF(12," Eliminar Seleccionados "),e.k0s()(),e.j41(13,"div",33)(14,"div",34)(15,"div",35)(16,"label",36),e.EFF(17,"Buscar por Nombre"),e.k0s(),e.j41(18,"input",37),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.searchTerm,i)||(s.searchTerm=i),e.Njj(i)}),e.bIt("input",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.applyFilters())}),e.k0s()(),e.j41(19,"div",35)(20,"label",38),e.EFF(21,"Filtrar por Estado"),e.k0s(),e.j41(22,"select",39),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.filterStatus,i)||(s.filterStatus=i),e.Njj(i)}),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.applyFilters())}),e.j41(23,"option",40),e.EFF(24,"Todos los Estados"),e.k0s(),e.j41(25,"option",41),e.EFF(26,"Iniciado"),e.k0s(),e.j41(27,"option",42),e.EFF(28,"Pendiente"),e.k0s(),e.j41(29,"option",43),e.EFF(30,"Cancelado"),e.k0s(),e.j41(31,"option",44),e.EFF(32,"Cerrado"),e.k0s()()(),e.j41(33,"div",35)(34,"label",45),e.EFF(35,"Filtrar por Ejecutivo"),e.k0s(),e.j41(36,"select",46),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.selectedExecutiveUid,i)||(s.selectedExecutiveUid=i),e.Njj(i)}),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.applyFilters())}),e.j41(37,"option",47),e.EFF(38,"Todos los Ejecutivos"),e.k0s(),e.DNE(39,L,2,3,"option",48),e.k0s()(),e.j41(40,"div",35)(41,"button",49),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.resetData())}),e.nrm(42,"i",50),e.EFF(43," Limpiar "),e.k0s()()()(),e.j41(44,"div",23)(45,"div",51)(46,"table",52)(47,"thead")(48,"tr")(49,"th")(50,"input",53),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleMasterCheckbox())}),e.k0s()(),e.j41(51,"th"),e.EFF(52,"Nombre"),e.k0s(),e.j41(53,"th"),e.EFF(54,"Tipo"),e.k0s(),e.j41(55,"th"),e.EFF(56,"Fecha"),e.k0s(),e.j41(57,"th"),e.EFF(58,"Estado"),e.k0s(),e.j41(59,"th"),e.EFF(60,"Ejecutivo Asignado"),e.k0s(),e.j41(61,"th"),e.EFF(62,"Acciones"),e.k0s()()(),e.j41(63,"tbody"),e.DNE(64,H,3,0,"tr",3)(65,z,19,15,"tr",54),e.k0s()()()(),e.j41(66,"div",55)(67,"p",27),e.EFF(68,"Elementos por p\xe1gina: "),e.j41(69,"select",56),e.bIt("change",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.onItemsPerPageChange(i))}),e.j41(70,"option",57),e.EFF(71,"10"),e.k0s(),e.j41(72,"option",57),e.EFF(73,"25"),e.k0s(),e.j41(74,"option",57),e.EFF(75,"50"),e.k0s(),e.j41(76,"option",57),e.EFF(77,"100"),e.k0s()()(),e.j41(78,"span",58),e.EFF(79),e.k0s()(),e.j41(80,"div",59)(81,"nav",60)(82,"ul",61)(83,"li",62)(84,"a",63),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onPageChange(i.currentPage-1))}),e.EFF(85,"Anterior"),e.k0s()(),e.DNE(86,J,3,3,"li",64),e.j41(87,"li",62)(88,"a",63),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onPageChange(i.currentPage+1))}),e.EFF(89,"Siguiente"),e.k0s()()()()()()}if(2&n){const t=e.XpG();e.R7$(10),e.Y8G("disabled",!t.showDeleteButton),e.R7$(8),e.R50("ngModel",t.searchTerm),e.R7$(4),e.R50("ngModel",t.filterStatus),e.R7$(14),e.R50("ngModel",t.selectedExecutiveUid),e.R7$(3),e.Y8G("ngForOf",t.executives),e.R7$(11),e.Y8G("checked",t.masterChecked),e.R7$(14),e.Y8G("ngIf",0===t.pagedClaims.length),e.R7$(),e.Y8G("ngForOf",t.pagedClaims),e.R7$(4),e.Y8G("ngModel",t.itemsPerPage),e.R7$(),e.Y8G("value",10),e.R7$(2),e.Y8G("value",25),e.R7$(2),e.Y8G("value",50),e.R7$(2),e.Y8G("value",100),e.R7$(3),e.Lme(" P\xe1gina ",t.currentPage," de ",t.getTotalPages()," "),e.R7$(4),e.AVh("disabled",1===t.currentPage),e.R7$(3),e.Y8G("ngForOf",t.getPagesArray()),e.R7$(),e.AVh("disabled",t.currentPage===t.getTotalPages())}}function W(n,a){if(1&n&&(e.j41(0,"span",83),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.JRh(null==t.selectedClaim?null:t.selectedClaim.id)}}function Z(n,a){if(1&n&&(e.j41(0,"option",57),e.EFF(1),e.k0s()),2&n){const t=a.$implicit;e.Y8G("value",t.uid),e.R7$(),e.Lme(" ",t.name+" "+t.last_name," - ",t.email," ")}}function Q(n,a){if(1&n){const t=e.RV6();e.j41(0,"form",84)(1,"div",85)(2,"label",86),e.EFF(3,"Nombre"),e.k0s(),e.j41(4,"input",87),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.selectedClaim.nombre,i)||(s.selectedClaim.nombre=i),e.Njj(i)}),e.k0s()(),e.j41(5,"div",85)(6,"label",86),e.EFF(7,"Asunto"),e.k0s(),e.j41(8,"input",88),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.selectedClaim.tipo,i)||(s.selectedClaim.tipo=i),e.Njj(i)}),e.k0s()(),e.j41(9,"div",85)(10,"label",86),e.EFF(11,"Estado"),e.k0s(),e.j41(12,"select",89),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.selectedClaim.estado,i)||(s.selectedClaim.estado=i),e.Njj(i)}),e.j41(13,"option",41),e.EFF(14,"Iniciado"),e.k0s(),e.j41(15,"option",42),e.EFF(16,"Pendiente"),e.k0s(),e.j41(17,"option",43),e.EFF(18,"Cancelado"),e.k0s(),e.j41(19,"option",44),e.EFF(20,"Cerrado"),e.k0s()()(),e.j41(21,"div",85)(22,"label",86),e.EFF(23,"Fecha"),e.k0s(),e.j41(24,"input",90),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.selectedClaim.fecha,i)||(s.selectedClaim.fecha=i),e.Njj(i)}),e.k0s()(),e.j41(25,"div",85)(26,"label",86),e.EFF(27,"Ejecutivo Asignado"),e.k0s(),e.j41(28,"select",91),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.selectedClaim.uidEjecutivo,i)||(s.selectedClaim.uidEjecutivo=i),e.Njj(i)}),e.DNE(29,Z,2,3,"option",48),e.k0s()(),e.j41(30,"div",92)(31,"label",86),e.EFF(32,"Descripci\xf3n"),e.k0s(),e.j41(33,"textarea",93),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.selectedClaim.detail,i)||(s.selectedClaim.detail=i),e.Njj(i)}),e.k0s()()()}if(2&n){const t=e.XpG(2);e.R7$(4),e.R50("ngModel",t.selectedClaim.nombre),e.Y8G("disabled",t.isViewOnly),e.R7$(4),e.R50("ngModel",t.selectedClaim.tipo),e.Y8G("disabled",t.isViewOnly),e.R7$(4),e.R50("ngModel",t.selectedClaim.estado),e.Y8G("disabled",t.isViewOnly),e.R7$(12),e.R50("ngModel",t.selectedClaim.fecha),e.Y8G("disabled",t.isViewOnly),e.R7$(4),e.R50("ngModel",t.selectedClaim.uidEjecutivo),e.Y8G("disabled",t.isViewOnly),e.R7$(),e.Y8G("ngForOf",t.executives),e.R7$(4),e.R50("ngModel",t.selectedClaim.detail),e.Y8G("disabled",t.isViewOnly)}}function q(n,a){1&n&&(e.j41(0,"div",94),e.EFF(1," No se ha cargado ning\xfan reclamo para ver/editar. "),e.k0s())}function ee(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",95),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.enableEdit())}),e.nrm(1,"i",96),e.EFF(2," Habilitar Edici\xf3n "),e.k0s()}}function te(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",97),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.saveChanges())}),e.nrm(1,"i",98),e.EFF(2," Guardar Cambios "),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("disabled",!t.isEditing)}}function ie(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",69)(1,"div",70)(2,"div",71)(3,"div",72)(4,"h5",73),e.EFF(5),e.DNE(6,W,2,1,"span",74),e.k0s(),e.j41(7,"button",75),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.cancelEdit())}),e.k0s()(),e.j41(8,"div",76),e.DNE(9,Q,34,13,"form",77)(10,q,2,0,"div",78),e.k0s(),e.j41(11,"div",79)(12,"button",80),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.cancelEdit())}),e.EFF(13,"Cerrar"),e.k0s(),e.DNE(14,ee,3,0,"button",81)(15,te,3,1,"button",82),e.k0s()()()()}if(2&n){const t=e.XpG();e.R7$(5),e.SpI(" ",t.isEditing?"Editar Reclamo":"Ver Reclamo"," "),e.R7$(),e.Y8G("ngIf",null==t.selectedClaim?null:t.selectedClaim.id),e.R7$(3),e.Y8G("ngIf",t.selectedClaim),e.R7$(),e.Y8G("ngIf",!t.selectedClaim),e.R7$(4),e.Y8G("ngIf",!t.isEditing),e.R7$(),e.Y8G("ngIf",t.isEditing)}}function oe(n,a){if(1&n&&(e.j41(0,"option",57),e.EFF(1),e.k0s()),2&n){const t=a.$implicit;e.Y8G("value",t.uid),e.R7$(),e.Lme(" ",t.name+" "+t.last_name," - ",t.email," ")}}function ne(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",69)(1,"div",99)(2,"div",100)(3,"div",72)(4,"h5",73),e.EFF(5,"Nuevo Reclamo"),e.k0s(),e.j41(6,"button",75),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.cancelNewClaim())}),e.k0s()(),e.j41(7,"div",76)(8,"form",84)(9,"div",85)(10,"label",86),e.EFF(11,"Nombre"),e.k0s(),e.j41(12,"input",101),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.newClaim.nombre,i)||(s.newClaim.nombre=i),e.Njj(i)}),e.k0s()(),e.j41(13,"div",85)(14,"label",86),e.EFF(15,"Asunto"),e.k0s(),e.j41(16,"input",102),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.newClaim.tipo,i)||(s.newClaim.tipo=i),e.Njj(i)}),e.k0s()(),e.j41(17,"div",92)(18,"label",86),e.EFF(19,"Descripci\xf3n"),e.k0s(),e.j41(20,"textarea",103),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.newClaim.detail,i)||(s.newClaim.detail=i),e.Njj(i)}),e.k0s()(),e.j41(21,"div",85)(22,"label",86),e.EFF(23,"Fecha"),e.k0s(),e.j41(24,"input",104),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.newClaim.fecha,i)||(s.newClaim.fecha=i),e.Njj(i)}),e.k0s()(),e.j41(25,"div",105)(26,"label",86),e.EFF(27,"Asignar a Ejecutivo"),e.k0s(),e.j41(28,"select",106),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.selectedExecutiveUid,i)||(s.selectedExecutiveUid=i),e.Njj(i)}),e.j41(29,"option",107),e.EFF(30,"Selecciona un ejecutivo"),e.k0s(),e.DNE(31,oe,2,3,"option",48),e.k0s()()()(),e.j41(32,"div",79)(33,"button",108),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.showNewModal=!1)}),e.EFF(34,"Cancelar"),e.k0s(),e.j41(35,"button",109),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.saveNewClaim())}),e.EFF(36,"Crear Reclamo"),e.k0s()()()()()}if(2&n){const t=e.XpG();e.R7$(12),e.R50("ngModel",t.newClaim.nombre),e.R7$(4),e.R50("ngModel",t.newClaim.tipo),e.R7$(4),e.R50("ngModel",t.newClaim.detail),e.R7$(4),e.R50("ngModel",t.newClaim.fecha),e.R7$(4),e.R50("ngModel",t.selectedExecutiveUid),e.R7$(),e.Y8G("ngValue",""),e.R7$(2),e.Y8G("ngForOf",t.executives)}}let se=(()=>{class n{claimsService;userService;alert;authService;notificationService;userUid=null;userData=null;allClaims=[];filteredClaims=[];pagedClaims=[];isLoading=!0;errorMessage=null;subscriptions=new w.yU;executives=[];selectedExecutiveUid="";searchTerm="";filterStatus="Todos";currentPage=1;itemsPerPage=10;masterChecked=!1;showDeleteButton=!1;showNewModal=!1;newClaim=this.getEmptyClaim();selectedClaim=null;isViewOnly=!1;showModal=!1;isEditing=!1;imageDefault="https://randomuser.me/api/portraits/men/40.jpg";metrics=[];claims=[];constructor(t,o,i,s,d){this.claimsService=t,this.userService=o,this.alert=i,this.authService=s,this.notificationService=d}ngOnInit(){this.authService.getCurrentUser().subscribe(t=>{t&&(this.userUid=t.uid,console.log("\u{1f4e6} Usuario autenticado:",this.userUid),this.userService.getUserProfile(this.userUid).subscribe({next:o=>{this.userData=o||null,console.log("%c<<< infoData | dashboard >>>","background: #198754; color: #fff; padding: 2px 5px;",this.userData)},error:o=>{console.error("\u274c Error al cargar perfil de usuario:",o)}}))}),this.loadExecutives(),this.loadAllClaims()}sendTestNotification(t){console.log("\u{1f514} Enviando notificaci\xf3n al ejecutivo UID:",t),t?this.notificationService.sendToUser(t,`Se te asign\xf3 el reclamo: ${this.newClaim?.nombre||"sin nombre"}`,"asignado").then(()=>console.log(`\u2705 Notificaci\xf3n enviada al ejecutivo: ${t}`)).catch(i=>console.error("\u274c Error al enviar notificaci\xf3n:",i)):console.warn("\u26a0\ufe0f UID del ejecutivo no est\xe1 definido. No se puede enviar notificaci\xf3n.")}loadExecutives(){const t=this.userService.getExecutives().subscribe({next:o=>{this.executives=o,console.log("\u2705 Ejecutivos cargados:",this.executives)},error:o=>{console.error("\u274c Error al cargar ejecutivos:",o),this.alert.error("No se pudieron cargar los ejecutivos.")}});this.subscriptions.add(t)}loadAllClaims(){this.isLoading=!0,this.errorMessage=null;const t=this.claimsService.getAllClaims().subscribe({next:o=>{this.allClaims=o.map(i=>({...i,selected:!1})),console.log("\u2705 Todos los reclamos cargados:",this.allClaims),this.isLoading=!1,this.applyFilters(),this.claims=[...this.allClaims],this.updateMetrics()},error:o=>{console.error("\u274c Error al cargar todos los reclamos:",o),this.errorMessage="No se pudieron cargar los reclamos. Int\xe9ntalo de nuevo m\xe1s tarde.",this.isLoading=!1}});this.subscriptions.add(t)}applyFilters(){let t=[...this.allClaims];this.searchTerm&&(t=t.filter(o=>o.nombre.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.filterStatus&&"Todos"!==this.filterStatus&&(t=t.filter(o=>o.estado===this.filterStatus)),this.selectedExecutiveUid&&(t=t.filter(o=>o.uidEjecutivo===this.selectedExecutiveUid)),this.filteredClaims=t,this.currentPage=1,this.updatePagedClaims(),this.updateDeleteButtonState(),this.masterChecked=this.filteredClaims.every(o=>o.selected)}updatePagedClaims(){const t=(this.currentPage-1)*this.itemsPerPage;this.pagedClaims=this.filteredClaims.slice(t,t+this.itemsPerPage)}openNewModal(){this.resetNewClaim(),this.showNewModal=!0,console.log("\u{1f4a1} showNewModal es:",this.showNewModal)}closeNewModal(){this.showNewModal=!1}saveNewClaim(){this.newClaim.nombre&&this.newClaim.estado&&this.selectedExecutiveUid?(this.newClaim.uidEjecutivo=this.selectedExecutiveUid,this.newClaim.id=this.generateUUID(),console.log("\u{1f195} Reclamo preparado para guardar:",this.newClaim),console.log("\u{1f3af} UID del ejecutivo seleccionado:",this.selectedExecutiveUid),this.isLoading=!0,this.claimsService.createClaim(this.newClaim.uidEjecutivo,this.newClaim).then(()=>{this.alert.success("Nuevo reclamo asignado con \xe9xito."),this.closeNewModal(),this.loadAllClaims(),this.notificationService.sendToUser(this.selectedExecutiveUid,`Se te asign\xf3 un nuevo reclamo: ${this.newClaim.nombre}`,"asignado").then(()=>console.log("\u2705 Notificaci\xf3n enviada al ejecutivo")).catch(t=>console.error("\u274c Error al enviar notificaci\xf3n:",t))}).catch(t=>{console.error("\u274c Error al crear reclamo:",t),this.alert.error("Ocurri\xf3 un error al crear el reclamo.")}).finally(()=>{this.isLoading=!1})):this.alert.showToastError("Por favor, completa todos los campos requeridos (nombre, estado, ejecutivo).","Campos Requeridos")}resetNewClaim(){this.newClaim=this.getEmptyClaim(),this.selectedExecutiveUid=""}getEmptyClaim(){return{id:"",nombre:"",tipo:"",total:0,estado:"Pendiente",fecha:(new Date).toISOString().split("T")[0],uidEjecutivo:"",selected:!1}}generateUUID(){return crypto.randomUUID()}resetData(){this.searchTerm="",this.filterStatus="Todos",this.selectedExecutiveUid="",this.currentPage=1,this.loadAllClaims(),this.alert.showToastInfo("Filtros restablecidos y datos recargados.","Informaci\xf3n")}toggleMasterCheckbox(){this.masterChecked=!this.masterChecked,this.filteredClaims.forEach(t=>t.selected=this.masterChecked),this.updateDeleteButtonState()}toggleClaimSelection(t){t.selected=!t.selected,this.masterChecked=this.filteredClaims.every(o=>o.selected),this.updateDeleteButtonState()}hasSelectedClaims(){return this.filteredClaims.some(t=>t.selected)}updateDeleteButtonState(){this.showDeleteButton=this.hasSelectedClaims()}deleteSelectedClaims(){var t=this;return(0,m.A)(function*(){const o=t.filteredClaims.filter(d=>d.selected);if(0===o.length)return void t.alert.showToastInfo("No hay reclamos seleccionados para eliminar.","Informaci\xf3n");if(!(yield t.alert.confirm("\xbfEst\xe1s seguro?","Esta acci\xf3n eliminar\xe1 los reclamos seleccionados de forma permanente.")))return;t.isLoading=!0;const s=[];for(const d of o)d.uidEjecutivo&&d.id?s.push(t.claimsService.deleteClaim(d.uidEjecutivo,d.id).catch(u=>{console.error(`\u274c Error al eliminar el reclamo ${d.id}:`,u),t.alert.error(`No se pudo eliminar el reclamo: ${d.nombre}`)})):console.warn("\u26a0\ufe0f No se pudo eliminar el reclamo (falta UID o ID):",d);Promise.all(s).then(()=>{t.alert.success("\u2705 Reclamos seleccionados eliminados con \xe9xito."),t.loadAllClaims()}).catch(d=>{console.error("Un error inesperado ocurri\xf3 durante la eliminaci\xf3n masiva:",d)}).finally(()=>{t.isLoading=!1,t.masterChecked=!1,t.updateDeleteButtonState()})})()}getExecutiveName(t){if(!t)return"N/A";const o=this.executives.find(i=>i.uid===t);return o?`${o.name||""} ${o.last_name||""}`.trim():"N/A"}viewClaim(t){console.log("\u{1f441}\ufe0f Ver reclamo:",t),this.selectedClaim={...t},this.isViewOnly=!0,this.showModal=!0,this.alert.showToastInfo(`Viendo reclamo: ${t.nombre}`,"Ver Reclamo")}editClaim(t){console.log("\u270f\ufe0f Editar reclamo button editClaim:",t),this.selectedClaim={...t},this.isViewOnly=!1,this.showModal=!0,this.alert.showToastInfo(`Editando reclamo: ${t.nombre}`,"Editar Reclamo")}openViewEditModal(t,o=!0){console.log("Abriendo modal para ver/editar reclamo:",t),this.selectedClaim={...t},this.isViewOnly=!0,this.isEditing=!1,this.showModal=!0,this.alert.showToastInfo(`Viendo reclamo: ${t.nombre}`,"Ver Reclamo")}enableEdit(){this.isViewOnly=!1,this.isEditing=!0,this.alert.showToastInfo("Modo de edici\xf3n activado.","Editar Reclamo")}toggleEditMode(){this.isViewOnly=!this.isViewOnly,this.alert.showToastInfo(this.isViewOnly?"Modo de visualizaci\xf3n activado.":"Modo de edici\xf3n activado.","Cambio de Modo")}saveChanges(){console.log("\u{1f4be} Guardando cambios para el reclamo:",this.selectedClaim),this.selectedClaim&&this.selectedClaim.uidEjecutivo&&this.selectedClaim.id?this.claimsService.updateClaim(this.selectedClaim.uidEjecutivo,this.selectedClaim).then(()=>{this.alert.showToastSuccess("\u2705 Reclamo actualizado con \xe9xito.","OK!"),this.loadAllClaims(),this.cancelEdit(),this.selectedClaim&&this.selectedClaim.uidEjecutivo?this.notificationService.sendToUser(this.selectedClaim.uidEjecutivo,`Se ha actualizado el reclamo #${this.selectedClaim.id}`,"editado").then(()=>console.log("\u2705 Notificaci\xf3n de edici\xf3n enviada al ejecutivo")).catch(o=>console.error("\u274c Error al enviar notificaci\xf3n de edici\xf3n:",o)):console.warn("\u26a0\ufe0f Reclamo sin ejecutivo asignado. No se env\xeda notificaci\xf3n.")}).catch(t=>{console.error("\u274c Error al actualizar el reclamo:",t),this.alert.showToastError("Ocurri\xf3 un error al actualizar el reclamo.","Error")}):this.alert.showToastError("No hay reclamo seleccionado o faltan datos para actualizar.","Error")}cancelEdit(){this.selectedClaim=null,this.showModal=!1,this.isEditing=!1,this.isViewOnly=!1}saveEditedClaim(){this.selectedClaim&&this.selectedClaim.uidEjecutivo&&this.selectedClaim.id?this.claimsService.updateClaim(this.selectedClaim.uidEjecutivo,this.selectedClaim).then(()=>{this.alert.success("\u2705 Reclamo actualizado con \xe9xito."),this.loadAllClaims(),this.cancelEdit()}).catch(t=>{console.error("\u274c Error al actualizar el reclamo:",t),this.alert.error("Ocurri\xf3 un error al actualizar el reclamo.")}):this.alert.showToastError("No hay reclamo seleccionado o faltan datos para actualizar.","Error")}cancelNewClaim(){this.newClaim=this.getEmptyClaim(),this.showNewModal=!1}getTotalPages(){return Math.ceil(this.filteredClaims.length/this.itemsPerPage)}getPagesArray(){return Array.from({length:this.getTotalPages()},(t,o)=>o+1)}onPageChange(t){t>=1&&t<=this.getTotalPages()&&(this.currentPage=t,this.updatePagedClaims())}onItemsPerPageChange(t){this.itemsPerPage=Number(t.target.value),this.currentPage=1,this.updatePagedClaims()}deleteClaim(t){const o=this.allClaims.find(i=>i.id===t);o&&o.uidEjecutivo?confirm("\xbfEst\xe1s seguro de que quieres eliminar este reclamo?")&&this.claimsService.deleteClaim(o.uidEjecutivo,t).then(()=>{this.alert.success("\u2705 Reclamo eliminado con \xe9xito."),this.loadAllClaims()}).catch(i=>{console.error("\u274c Error al eliminar el reclamo:",i),this.alert.error("Ocurri\xf3 un error al eliminar el reclamo.")}):this.alert.showToastError("No se pudo encontrar el reclamo para eliminar o falta el UID del ejecutivo.","Error")}ngOnDestroy(){this.subscriptions.unsubscribe()}updateMetrics(){const t=this.claims.length,o=this.claims.filter(u=>"Iniciado"===u.estado).length,i=this.claims.filter(u=>"Pendiente"===u.estado).length,s=this.claims.filter(u=>"Cancelado"===u.estado).length,d=this.claims.filter(u=>"Cerrado"===u.estado).length;console.log("\u{1f4ca} M\xe9tricas actualizadas:"),console.log("\u27a1\ufe0f Total:",t),console.log("\u{1f7e6} Iniciados:",o),console.log("\u{1f7e8} Pendientes:",i),console.log("\u{1f7e5} Cancelados:",s),console.log("\u{1f7e9} Cerrados:",d),this.metrics=[{icon:"bi-folder-check",count:t,label:"Total de Reclamos",color:"primary",footerText:"Todos los reclamos registrados",trendIcon:"bi-bar-chart"},{icon:"bi-play-circle",count:o,label:"Iniciados",color:"info",footerText:"Reclamos en inicio",trendIcon:"bi-graph-up"},{icon:"bi-hourglass-split",count:i,label:"Pendientes",color:"warning",footerText:"Requieren atenci\xf3n",trendIcon:"bi-exclamation-circle"},{icon:"bi-x-circle",count:s,label:"Cancelados",color:"danger",footerText:"No continuaron",trendIcon:"bi-x-circle"},{icon:"bi-check-circle",count:d,label:"Cerrados",color:"success",footerText:"Reclamos resueltos",trendIcon:"bi-check-circle"}]}static \u0275fac=function(o){return new(o||n)(e.rXU(N.B),e.rXU(y.D),e.rXU(F.u),e.rXU(_.u),e.rXU(P.J))};static \u0275cmp=e.VBU({type:n,selectors:[["app-admin-claims"]],decls:15,vars:8,consts:[[1,"row"],[1,"col-12","grid-margin"],["class","d-flex justify-content-center align-items-center","style","height: 200px;",4,"ngIf"],[4,"ngIf"],[1,"row","grid-margin"],["class","col-md-6 col-xl-3 my-3",4,"ngFor","ngForOf"],[1,"card"],[1,"card-body"],["class","col-12 mt-3",4,"ngIf"],["class","row",4,"ngIf"],["class","modal fade show d-block","style","background-color: rgba(0,0,0,0.4); z-index: 1050;",4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center",2,"height","200px"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"d-flex","align-items-center","mb-4","mb-lg-0","py-4"],[1,"position-relative","d-inline-block"],["alt","Profile Picture","width","100","height","100",1,"border","border-5","border-primary","rounded-circle","profile-pic","border-opacity-25","object-fit-cover",3,"src"],[1,"ms-3","text-start"],[1,"m-0","p-0"],[1,"m-0","p-0","text-muted"],[1,"badge","badge-type","badge-outline-info"],[1,"col-md-6","col-xl-3","my-3"],[3,"icon","count","label","color","footerText","trendIcon"],[1,"col-12","mt-3"],["role","alert",1,"alert","alert-danger","text-center"],[1,"col-6"],[1,"h3","m-0"],[1,"mb-0"],[1,"col-6","d-flex","justify-content-end","align-items-center"],[1,"btn","btn-full","--primary","m-1","btn-sm",3,"click"],[1,"bi","bi-plus-circle","me-1"],[1,"btn","btn-full","--danger","m-1","btn-sm",3,"click","disabled"],[1,"bi","bi-trash","me-1"],[1,"col-12","py-3"],[1,"row","g-3","align-items-center"],[1,"col-md-3"],["for","searchTerm",1,"form-label","visually-hidden"],["type","text","id","searchTerm","placeholder","Buscar por nombre...",1,"form-control",3,"ngModelChange","input","ngModel"],["for","filterStatus",1,"form-label","visually-hidden"],["id","filterStatus",1,"form-select",3,"ngModelChange","change","ngModel"],["value","Todos"],["value","Iniciado"],["value","Pendiente"],["value","Cancelado"],["value","Cerrado"],["for","selectedExecutive",1,"form-label","visually-hidden"],["id","selectedExecutive",1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-full","--primary","m-1","w-100",3,"click"],[1,"bi","bi-arrow-counterclockwise","me-1"],[1,"table-responsive"],[1,"table","table-light","table-hover","align-middle"],["type","checkbox",1,"form-check-input",3,"change","checked"],[4,"ngFor","ngForOf"],[1,"co-sm-12","col-md-6","py-3","d-flex","justify-content-start","align-items-center"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"change","ngModel"],[3,"value"],[1,"mx-2"],[1,"co-sm-12","col-md-6","py-3","d-flex","justify-content-end","align-items-center"],["aria-label","Page navigation"],[1,"pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],["colspan","7",1,"text-center","text-muted","py-4"],[1,"badge",3,"ngClass"],[1,"btn","btn-full","--info","m-1","btn-sm",3,"click"],[1,"bi","bi-eye-fill"],[1,"modal","fade","show","d-block",2,"background-color","rgba(0,0,0,0.4)","z-index","1050"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["class","badge bg-secondary ms-2",4,"ngIf"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["class","row g-3",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-full","--danger","m-1",3,"click"],["type","button","class","btn btn-full --primary m-1",3,"click",4,"ngIf"],["type","button","class","btn btn-full --success m-1",3,"disabled","click",4,"ngIf"],[1,"badge","bg-secondary","ms-2"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],["name","selectedNombre","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["name","selectedTipo",1,"form-control",3,"ngModelChange","ngModel","disabled"],["name","selectedEstado",1,"form-select",3,"ngModelChange","ngModel","disabled"],["name","selectedFecha","type","date",1,"form-control",3,"ngModelChange","ngModel","disabled"],["name","selectedEjecutivo",1,"form-select",3,"ngModelChange","ngModel","disabled"],[1,"col-12"],["name","selectedDetail","rows","3",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"alert","alert-warning"],["type","button",1,"btn","btn-full","--primary","m-1",3,"click"],[1,"bi","bi-pencil-square","me-1"],["type","button",1,"btn","btn-full","--success","m-1",3,"click","disabled"],[1,"bi","bi-save","me-1"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content","rounded","shadow-lg"],["name","newNombre","required","",1,"form-control",3,"ngModelChange","ngModel"],["name","newTipo",1,"form-control",3,"ngModelChange","ngModel"],["name","newDetail","rows","3",1,"form-control",3,"ngModelChange","ngModel"],["name","newFecha","type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-12"],["name","ejecutivo","required","",1,"form-select",3,"ngModelChange","ngModel"],["disabled","","selected","",3,"ngValue"],[1,"btn","btn-full","--primary","m-1",3,"click"],[1,"btn","btn-full","--success","m-1",3,"click"]],template:function(o,i){1&o&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,V,4,0,"div",2)(3,B,16,3,"div",3),e.k0s()(),e.j41(4,"div",4),e.DNE(5,Y,2,6,"div",5),e.k0s(),e.j41(6,"div",0)(7,"div",1)(8,"div",6)(9,"div",7),e.DNE(10,X,4,0,"div",2)(11,O,3,1,"div",8)(12,K,90,20,"div",9),e.k0s()()()(),e.DNE(13,ie,16,6,"div",10)(14,ne,37,7,"div",10)),2&o&&(e.R7$(2),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",!i.isLoading&&i.userData),e.R7$(2),e.Y8G("ngForOf",i.metrics),e.R7$(5),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",i.errorMessage),e.R7$(),e.Y8G("ngIf",!i.isLoading&&!i.errorMessage),e.R7$(),e.Y8G("ngIf",i.showModal),e.R7$(),e.Y8G("ngIf",i.showNewModal))},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.vh,r.YN,r.qT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.YS,r.vS,r.cV,S._],encapsulation:2})}return n})();var ae=l(983),M=l(6354),le=l(9437),re=l(7759);const ce=(n,a,t,o)=>({"bg-primary":n,"bg-warning text-dark":a,"bg-danger":t,"bg-success":o}),D=n=>({"is-invalid":n});function de(n,a){1&n&&(e.j41(0,"div",11)(1,"div",12)(2,"span",13),e.EFF(3,"Loading..."),e.k0s()()())}function me(n,a){if(1&n&&(e.j41(0,"div")(1,"div",6)(2,"div",7)(3,"div",14)(4,"div",15),e.nrm(5,"img",16),e.k0s(),e.j41(6,"div",17)(7,"h2",18),e.EFF(8),e.k0s(),e.j41(9,"h6",18),e.EFF(10,"Bienvenido a tu aplicaci\xf3n"),e.k0s(),e.j41(11,"p",19),e.EFF(12,"Este es tu panel de control, aqu\xed puedes administrar tus tareas, ver estad\xedsticas y m\xe1s."),e.k0s(),e.j41(13,"p",19)(14,"span",20),e.EFF(15),e.k0s()()()()()()()),2&n){const t=e.XpG();e.R7$(5),e.Y8G("src",t.userData.photoURL||t.imageDefault,e.B4B),e.R7$(3),e.SpI("Hola, ",t.userData.name||"Invitado",""),e.R7$(7),e.JRh(t.userData.rol||"Desconocido")}}function ue(n,a){if(1&n&&(e.j41(0,"div",21),e.nrm(1,"app-card-metric",22),e.k0s()),2&n){const t=a.$implicit;e.R7$(),e.Y8G("icon",t.icon)("count",t.count)("label",t.label)("color",t.color)("footerText",t.footerText)("trendIcon",t.trendIcon)}}function ge(n,a){1&n&&(e.j41(0,"div",11)(1,"div",12)(2,"span",13),e.EFF(3,"Loading..."),e.k0s()()())}function pe(n,a){if(1&n&&(e.j41(0,"div",23)(1,"div",24),e.EFF(2),e.k0s()()),2&n){const t=e.XpG();e.R7$(2),e.SpI(" ",t.errorMessage," ")}}function he(n,a){1&n&&(e.j41(0,"div",23)(1,"div",25),e.EFF(2," No tienes reclamos asignados. "),e.k0s()())}function fe(n,a){1&n&&(e.j41(0,"tr")(1,"td",60),e.EFF(2,"No se encontraron reclamos con los filtros aplicados."),e.k0s()())}function ve(n,a){if(1&n){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"input",50),e.bIt("change",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.toggleClaimSelection(i))}),e.k0s()(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"date"),e.k0s(),e.j41(10,"td")(11,"span",61),e.EFF(12),e.k0s()(),e.j41(13,"td")(14,"button",62),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.viewClaim(i))}),e.nrm(15,"i",63),e.EFF(16," Ver / Editar "),e.k0s()()()}if(2&n){const t=a.$implicit;e.R7$(2),e.Y8G("checked",t.selected),e.R7$(2),e.JRh(t.nombre),e.R7$(2),e.JRh(t.tipo),e.R7$(2),e.JRh(e.i5U(9,6,t.fecha,"shortDate")),e.R7$(3),e.Y8G("ngClass",e.ziG(9,ce,"Iniciado"===t.estado,"Pendiente"===t.estado,"Cancelado"===t.estado,"Cerrado"===t.estado)),e.R7$(),e.SpI(" ",t.estado," ")}}function _e(n,a){if(1&n){const t=e.RV6();e.j41(0,"li",57)(1,"a",58),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.onPageChange(i))}),e.EFF(2),e.k0s()()}if(2&n){const t=a.$implicit,o=e.XpG(2);e.AVh("active",t===o.currentPage),e.R7$(2),e.JRh(t)}}function Ce(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",0)(1,"div",26)(2,"h2",27),e.EFF(3,"Administraci\xf3n de Reclamaciones"),e.k0s(),e.j41(4,"p",28),e.EFF(5,"Aqu\xed puedes gestionar todas las reclamaciones asignadas a ti."),e.k0s()(),e.j41(6,"div",29)(7,"button",30),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.deleteSelectedClaims())}),e.nrm(8,"i",31),e.EFF(9," Eliminar Seleccionados "),e.k0s()(),e.j41(10,"div",32)(11,"div",33)(12,"div",34)(13,"label",35),e.EFF(14,"Buscar por Nombre"),e.k0s(),e.j41(15,"input",36),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.searchTerm,i)||(s.searchTerm=i),e.Njj(i)}),e.bIt("input",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.applyFilters())}),e.k0s()(),e.j41(16,"div",37)(17,"label",38),e.EFF(18,"Filtrar por Estado"),e.k0s(),e.j41(19,"select",39),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.filterStatus,i)||(s.filterStatus=i),e.Njj(i)}),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.applyFilters())}),e.j41(20,"option",40),e.EFF(21,"Todos los Estados"),e.k0s(),e.j41(22,"option",41),e.EFF(23,"Iniciado"),e.k0s(),e.j41(24,"option",42),e.EFF(25,"Pendiente"),e.k0s(),e.j41(26,"option",43),e.EFF(27,"Cancelado"),e.k0s(),e.j41(28,"option",44),e.EFF(29,"Cerrado"),e.k0s()()(),e.j41(30,"div",45)(31,"button",46),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return i.searchTerm="",i.filterStatus="Todos",e.Njj(i.applyFilters())}),e.nrm(32,"i",47),e.EFF(33," Limpiar Filtros "),e.k0s()()()(),e.j41(34,"div",23)(35,"div",48)(36,"table",49)(37,"thead")(38,"tr")(39,"th")(40,"input",50),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.toggleMasterCheckbox())}),e.k0s()(),e.j41(41,"th"),e.EFF(42,"Nombre"),e.k0s(),e.j41(43,"th"),e.EFF(44,"Tipo"),e.k0s(),e.j41(45,"th"),e.EFF(46,"Fecha"),e.k0s(),e.j41(47,"th"),e.EFF(48,"Estado"),e.k0s(),e.j41(49,"th"),e.EFF(50,"Acciones"),e.k0s()()(),e.j41(51,"tbody"),e.DNE(52,fe,3,0,"tr",3)(53,ve,17,14,"tr",51),e.k0s()()()(),e.j41(54,"div",52)(55,"div"),e.EFF(56," Elementos por p\xe1gina: "),e.j41(57,"select",53),e.bIt("change",function(i){e.eBV(t);const s=e.XpG();return e.Njj(s.onItemsPerPageChange(i))}),e.j41(58,"option",54),e.EFF(59,"10"),e.k0s(),e.j41(60,"option",54),e.EFF(61,"25"),e.k0s(),e.j41(62,"option",54),e.EFF(63,"50"),e.k0s(),e.j41(64,"option",54),e.EFF(65,"100"),e.k0s()()(),e.j41(66,"nav",55)(67,"ul",56)(68,"li",57)(69,"a",58),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onPageChange(i.currentPage-1))}),e.EFF(70,"Anterior"),e.k0s()(),e.DNE(71,_e,3,3,"li",59),e.j41(72,"li",57)(73,"a",58),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onPageChange(i.currentPage+1))}),e.EFF(74,"Siguiente"),e.k0s()()()(),e.j41(75,"div"),e.EFF(76),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(7),e.Y8G("disabled",!t.showDeleteButton),e.R7$(8),e.R50("ngModel",t.searchTerm),e.R7$(4),e.R50("ngModel",t.filterStatus),e.R7$(21),e.Y8G("checked",t.masterChecked),e.R7$(12),e.Y8G("ngIf",0===t.pagedClaims.length),e.R7$(),e.Y8G("ngForOf",t.pagedClaims),e.R7$(4),e.Y8G("ngModel",t.itemsPerPage),e.R7$(),e.Y8G("value",10),e.R7$(2),e.Y8G("value",25),e.R7$(2),e.Y8G("value",50),e.R7$(2),e.Y8G("value",100),e.R7$(4),e.AVh("disabled",1===t.currentPage),e.R7$(3),e.Y8G("ngForOf",t.getPagesArray()),e.R7$(),e.AVh("disabled",t.currentPage===t.getTotalPages()),e.R7$(4),e.Lme(" P\xe1gina ",t.currentPage," de ",t.getTotalPages()," ")}}function be(n,a){1&n&&(e.j41(0,"div",86),e.EFF(1," El nombre es requerido. "),e.k0s())}function Ee(n,a){1&n&&(e.j41(0,"div",86),e.EFF(1," El estado es requerido. "),e.k0s())}function Fe(n,a){1&n&&(e.j41(0,"div",86),e.EFF(1," La fecha es requerida. "),e.k0s())}function je(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",87),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.enableEdit())}),e.nrm(1,"i",88),e.EFF(2," Habilitar Edici\xf3n "),e.k0s()}}function xe(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",89),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.saveChanges())}),e.nrm(1,"i",90),e.EFF(2," Guardar Cambios "),e.k0s()}if(2&n){const t=e.XpG(2);e.Y8G("disabled",!t.isEditing||t.claimForm.invalid)}}function ke(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",64)(1,"div",65)(2,"div",66)(3,"div",67)(4,"h5",68),e.EFF(5,"Detalle de Reclamo "),e.j41(6,"span",69),e.EFF(7),e.k0s()(),e.j41(8,"button",70),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.cancelEdit())}),e.k0s()(),e.j41(9,"div",71)(10,"form",72)(11,"div",73)(12,"label",74),e.EFF(13,"Nombre"),e.k0s(),e.nrm(14,"input",75),e.DNE(15,be,2,0,"div",76),e.k0s(),e.j41(16,"div",73)(17,"label",74),e.EFF(18,"Tipo (Asunto)"),e.k0s(),e.nrm(19,"input",77),e.k0s(),e.j41(20,"div",78)(21,"label",74),e.EFF(22,"Descripci\xf3n"),e.k0s(),e.nrm(23,"textarea",79),e.k0s(),e.j41(24,"div",73)(25,"label",74),e.EFF(26,"Estado"),e.k0s(),e.j41(27,"select",80)(28,"option",41),e.EFF(29,"Iniciado"),e.k0s(),e.j41(30,"option",42),e.EFF(31,"Pendiente"),e.k0s(),e.j41(32,"option",43),e.EFF(33,"Cancelado"),e.k0s(),e.j41(34,"option",44),e.EFF(35,"Cerrado"),e.k0s()(),e.DNE(36,Ee,2,0,"div",76),e.k0s(),e.j41(37,"div",73)(38,"label",74),e.EFF(39,"Fecha"),e.k0s(),e.nrm(40,"input",81),e.DNE(41,Fe,2,0,"div",76),e.k0s()()(),e.j41(42,"div",82)(43,"button",83),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.cancelEdit())}),e.EFF(44,"Cerrar"),e.k0s(),e.DNE(45,je,3,0,"button",84)(46,xe,3,1,"button",85),e.k0s()()()()}if(2&n){const t=e.XpG();e.R7$(7),e.JRh(null==t.selectedClaim?null:t.selectedClaim.id),e.R7$(3),e.Y8G("formGroup",t.claimForm),e.R7$(4),e.Y8G("ngClass",e.eq3(10,D,t.getFormControl("nombre").invalid&&t.getFormControl("nombre").touched)),e.R7$(),e.Y8G("ngIf",t.getFormControl("nombre").invalid&&t.getFormControl("nombre").touched),e.R7$(12),e.Y8G("ngClass",e.eq3(12,D,t.getFormControl("estado").invalid&&t.getFormControl("estado").touched)),e.R7$(9),e.Y8G("ngIf",t.getFormControl("estado").invalid&&t.getFormControl("estado").touched),e.R7$(4),e.Y8G("ngClass",e.eq3(14,D,t.getFormControl("fecha").invalid&&t.getFormControl("fecha").touched)),e.R7$(),e.Y8G("ngIf",t.getFormControl("fecha").invalid&&t.getFormControl("fecha").touched),e.R7$(4),e.Y8G("ngIf",!t.isEditing),e.R7$(),e.Y8G("ngIf",t.isEditing)}}let Te=(()=>{class n{fb;claimsService;authService;alert;userService;mockService;notificationService;executiveClaims=[];filteredClaims=[];userData=null;isLoading=!0;errorMessage=null;claimForm;isEditing=!1;showModal=!1;isViewOnly=!0;subscriptions=new w.yU;selectedClaim=null;currentUserUid=null;TEST_EXECUTIVE_UID="KVDf8PfHEWMdic0SQPcxFMizoBf2";searchTerm="";filterStatus="Todos";masterChecked=!1;showDeleteButton=!1;currentPage=1;itemsPerPage=10;pagedClaims=[];imagePath="assets/images/isotipo-webmain.svg";imageDefault="https://maxuber79.github.io/gsaforce/assets/images/face28.jpg";metrics=[{label:"Total Claims",icon:"bi-list",count:0,color:"primary",footerText:"Actualizado en tiempo real",trendIcon:"bi-arrow-repeat"},{label:"Pendientes",icon:"bi-hourglass",count:0,color:"warning",footerText:"Revisar cuanto antes",trendIcon:"bi-hourglass-split"},{label:"Cerrados",icon:"bi-check-circle",count:0,color:"success",footerText:"Resueltos con \xe9xito",trendIcon:"bi-check2"},{label:"Cancelados",icon:"bi-x-circle",count:0,color:"danger",footerText:"No continuaron",trendIcon:"bi-x"}];constructor(t,o,i,s,d,u,Se){this.fb=t,this.claimsService=o,this.authService=i,this.alert=s,this.userService=d,this.mockService=u,this.notificationService=Se}ngOnInit(){this.initializeForm(),this.authService.getAuthState().subscribe(t=>{t&&(this.currentUserUid=t.uid,console.log(`\u{1f510} Usuario autenticado: ${t.email} (UID: ${this.currentUserUid})`),this.userService.getUserData(this.currentUserUid).subscribe({next:o=>{this.userData=o||null,console.log("%c<<< userData | executive >>>","background: #198754; color: #fff;",this.userData),this.userData&&this.userData.uid?(this.claimsService.getUserClaims(this.userData.uid).subscribe(i=>{this.updateMetrics(i),console.log("%c<<< claims para m\xe9tricas >>>","background: #198754; color: #fff;",i)}),this.loadExecutiveClaims(this.userData.uid)):console.warn("\u26a0\ufe0f No se encontr\xf3 userData.uid, no se cargan reclamos")},error:o=>{console.error("\u274c Error al obtener datos del usuario:",o)}}))})}updateMetrics(t){const o=t.length,i=t.filter(u=>"Pendiente"===u.estado||"Iniciado"===u.estado).length,s=t.filter(u=>"Cerrado"===u.estado).length,d=t.filter(u=>"Cancelado"===u.estado).length;this.metrics[0].count=o,this.metrics[1].count=i,this.metrics[2].count=s,this.metrics[3].count=d}initializeForm(t){this.claimForm=this.fb.group({id:[t?.id||null],nombre:[t?.nombre||"",r.k0.required],tipo:[t?.tipo||""],detail:[t?.detail||""],estado:[t?.estado||"Pendiente",r.k0.required],fecha:[t?.fecha||(new Date).toISOString().split("T")[0],r.k0.required],uidEjecutivo:[t?.uidEjecutivo||this.TEST_EXECUTIVE_UID]})}loadExecutiveClaims(t){this.isLoading=!0,this.errorMessage=null;const o=this.claimsService.getClaimsByUid(t).pipe((0,M.T)(i=>i.map(s=>({...s,selected:!1}))),(0,le.W)(i=>(console.error("\u274c Error al cargar reclamos del ejecutivo:",i),this.errorMessage="No se pudieron cargar los reclamos. Int\xe9ntalo de nuevo m\xe1s tarde.",this.isLoading=!1,ae.w))).subscribe({next:i=>{this.executiveClaims=i,this.isLoading=!1,console.log("\u2705 Reclamos del ejecutivo cargados:",this.executiveClaims),this.updateDeleteButtonState(),this.masterChecked=!1,this.applyFilters()}});this.subscriptions.add(o)}applyFilters(){let t=[...this.executiveClaims];this.searchTerm&&(t=t.filter(o=>o.nombre.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.filterStatus&&"Todos"!==this.filterStatus&&(t=t.filter(o=>o.estado===this.filterStatus)),this.filteredClaims=t,this.currentPage=1,this.updatePagedClaims()}viewClaim(t){this.selectedClaim={...t},this.initializeForm(this.selectedClaim),this.isEditing=!1,this.claimForm.disable(),this.showModal=!0,console.log("\u{1f50d} Reclamo seleccionado para ver/editar:",this.selectedClaim)}enableEdit(){this.isEditing=!0,this.claimForm.enable(),this.claimForm.get("id")?.disable(),this.claimForm.get("uidEjecutivo")?.disable()}saveChanges(){if(this.isEditing&&this.claimForm.valid&&this.selectedClaim){this.isLoading=!0;const t={id:this.selectedClaim.id,uidEjecutivo:this.selectedClaim.uidEjecutivo||this.TEST_EXECUTIVE_UID,...this.claimForm.getRawValue()};this.claimsService.updateClaim(t.uidEjecutivo,t).then(()=>{this.alert.success("\u2705 Reclamo actualizado con \xe9xito."),this.notificationService.sendToAdmins(`El ejecutivo <strong>${this.userData?.user_name}</strong> ha <strong>modificado</strong> el reclamo <strong>#${t.id}</strong>.`,"admin-alert"),this.cancelEdit(),this.loadExecutiveClaims(t.uidEjecutivo)}).catch(o=>{console.error("\u274c Error actualizando reclamo:",o),this.alert.error("Ocurri\xf3 un error al actualizar el reclamo. Int\xe9ntalo de nuevo."),this.isLoading=!1})}else this.isEditing?(this.claimForm.markAllAsTouched(),this.alert.showToastError("Por favor, completa todos los campos requeridos.","Formulario inv\xe1lido")):this.alert.showToastInfo('Haz clic en "Habilitar Edici\xf3n" para modificar el reclamo.',"Modo de Solo Lectura")}cancelEdit(){this.showModal=!1,this.selectedClaim=null,this.claimForm.reset(),this.errorMessage=null,this.isEditing=!1}getFormControl(t){return this.claimForm.get(t)}toggleMasterCheckbox(){this.masterChecked=!this.masterChecked,this.executiveClaims.forEach(t=>t.selected=this.masterChecked),this.updateDeleteButtonState()}toggleClaimSelection(t){t.selected=!t.selected,this.masterChecked=this.executiveClaims.every(o=>o.selected),this.updateDeleteButtonState()}hasSelectedClaims(){return this.executiveClaims.some(t=>t.selected)}updateDeleteButtonState(){this.showDeleteButton=this.hasSelectedClaims()}deleteSelectedClaims(){var t=this;return(0,m.A)(function*(){const o=t.executiveClaims.filter(d=>d.selected);if(0===o.length)return void t.alert.showToastInfo("No hay reclamos seleccionados para eliminar.","Informaci\xf3n");if(!(yield t.alert.confirm("\xbfEst\xe1s seguro?","Esta acci\xf3n eliminar\xe1 los reclamos seleccionados de forma permanente.")))return;t.isLoading=!0;const s=[];for(const d of o)d.uidEjecutivo&&d.id?s.push(t.claimsService.deleteClaim(d.uidEjecutivo,d.id).catch(u=>{console.error(`\u274c Error al eliminar el reclamo ${d.id}:`,u),t.alert.error(`No se pudo eliminar el reclamo: ${d.nombre}`)})):console.warn("\u26a0\ufe0f No se pudo eliminar el reclamo (falta UID o ID):",d);Promise.all(s).then(()=>{t.alert.success("\u2705 Reclamos seleccionados eliminados con \xe9xito."),t.currentUserUid&&t.loadExecutiveClaims(t.currentUserUid)}).catch(d=>{console.error("Un error inesperado ocurri\xf3 durante la eliminaci\xf3n masiva:",d)}).finally(()=>{t.isLoading=!1,t.masterChecked=!1,t.updateDeleteButtonState()})})()}updatePagedClaims(){const t=(this.currentPage-1)*this.itemsPerPage;this.pagedClaims=this.filteredClaims.slice(t,t+this.itemsPerPage)}getTotalPages(){return Math.ceil(this.filteredClaims.length/this.itemsPerPage)}getPagesArray(){return Array.from({length:this.getTotalPages()},(t,o)=>o+1)}onPageChange(t){t>=1&&t<=this.getTotalPages()&&(this.currentPage=t,this.updatePagedClaims())}onItemsPerPageChange(t){this.itemsPerPage=Number(t.target.value),this.currentPage=1,this.updatePagedClaims()}ngOnDestroy(){this.subscriptions.unsubscribe()}static \u0275fac=function(o){return new(o||n)(e.rXU(r.ok),e.rXU(N.B),e.rXU(_.u),e.rXU(F.u),e.rXU(y.D),e.rXU(re.I),e.rXU(P.J))};static \u0275cmp=e.VBU({type:n,selectors:[["app-executive-claims"]],decls:15,vars:8,consts:[[1,"row"],[1,"col-12","grid-margin"],["class","d-flex justify-content-center align-items-center","style","height: 200px;",4,"ngIf"],[4,"ngIf"],[1,"row","grid-margin"],["class","col-md-6 col-xl-3 my-3 ",4,"ngFor","ngForOf"],[1,"card"],[1,"card-body"],["class","col-12 mt-3",4,"ngIf"],["class","row",4,"ngIf"],["class","modal fade show d-block","style","background-color: rgba(0,0,0,0.4); z-index: 1050;",4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center",2,"height","200px"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"d-flex","align-items-center","mb-4","mb-lg-0","py-4"],[1,"position-relative","d-inline-block"],["alt","Profile Picture","width","100","height","100",1,"border","border-5","border-primary","rounded-circle","profile-pic","border-opacity-25","object-fit-cover",3,"src"],[1,"ms-3","text-start"],[1,"m-0","p-0"],[1,"m-0","p-0","text-muted"],[1,"badge","badge-type","badge-outline-info"],[1,"col-md-6","col-xl-3","my-3"],[3,"icon","count","label","color","footerText","trendIcon"],[1,"col-12","mt-3"],["role","alert",1,"alert","alert-danger","text-center"],["role","alert",1,"alert","alert-info","text-center"],[1,"col-6"],[1,"h3","mb-3"],[1,"mb-0"],[1,"col-6","text-end"],[1,"btn","btn-full","--danger","m-1","btn-sm",3,"click","disabled"],[1,"bi","bi-trash","me-1"],[1,"col-12","my-3"],[1,"row","g-3","align-items-center"],[1,"col-md-5"],["for","searchTerm",1,"form-label","visually-hidden"],["type","text","id","searchTerm","placeholder","Buscar por nombre...",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"col-md-4"],["for","filterStatus",1,"form-label","visually-hidden"],["id","filterStatus",1,"form-select",3,"ngModelChange","change","ngModel"],["value","Todos"],["value","Iniciado"],["value","Pendiente"],["value","Cancelado"],["value","Cerrado"],[1,"col-md-3"],[1,"btn","btn-secondary","w-100",3,"click"],[1,"bi","bi-arrow-counterclockwise","me-1"],[1,"table-responsive"],[1,"table","table-light","table-hover","align-middle"],["type","checkbox",1,"form-check-input",3,"change","checked"],[4,"ngFor","ngForOf"],[1,"col-12","d-flex","justify-content-between","align-items-center","mt-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"change","ngModel"],[3,"value"],["aria-label","Page navigation"],[1,"pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],["colspan","6",1,"text-center","text-muted","py-4"],[1,"badge",3,"ngClass"],[1,"btn","btn-full","--secondary","m-1","btn-sm",3,"click"],[1,"bi","bi-eye"],[1,"modal","fade","show","d-block",2,"background-color","rgba(0,0,0,0.4)","z-index","1050"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content","rounded","shadow-lg"],[1,"modal-header"],[1,"modal-title"],[1,"badge","badge-full-secondary"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"row","g-3",3,"formGroup"],[1,"col-md-6"],[1,"form-label"],["formControlName","nombre",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["formControlName","tipo",1,"form-control"],[1,"col-12"],["formControlName","detail","rows","3",1,"form-control"],["formControlName","estado",1,"form-select",3,"ngClass"],["formControlName","fecha","type","date",1,"form-control",3,"ngClass"],[1,"modal-footer"],["type","button",1,"btn","btn-full","--warning","m-1",3,"click"],["type","button","class","btn btn-full --primary m-1",3,"click",4,"ngIf"],["type","button","class","btn btn-full --success m-1",3,"disabled","click",4,"ngIf"],[1,"invalid-feedback"],["type","button",1,"btn","btn-full","--primary","m-1",3,"click"],[1,"bi","bi-pencil-square","me-1"],["type","button",1,"btn","btn-full","--success","m-1",3,"click","disabled"],[1,"bi","bi-save","me-1"]],template:function(o,i){1&o&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,de,4,0,"div",2)(3,me,16,3,"div",3),e.k0s()(),e.j41(4,"div",4),e.DNE(5,ue,2,6,"div",5),e.k0s(),e.j41(6,"div",0)(7,"div",1)(8,"div",6)(9,"div",7),e.DNE(10,ge,4,0,"div",2)(11,pe,3,1,"div",8)(12,he,3,0,"div",8)(13,Ce,77,18,"div",9),e.k0s()()()(),e.DNE(14,ke,47,16,"div",10)),2&o&&(e.R7$(2),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",!i.isLoading&&i.userData),e.R7$(2),e.Y8G("ngForOf",i.metrics),e.R7$(5),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",i.errorMessage),e.R7$(),e.Y8G("ngIf",!i.isLoading&&0===i.executiveClaims.length&&!i.errorMessage),e.R7$(),e.Y8G("ngIf",!i.isLoading&&i.executiveClaims.length>0&&!i.errorMessage),e.R7$(),e.Y8G("ngIf",i.showModal))},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.vh,r.YN,r.qT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.vS,r.X1,r.j4,r.JD,S._],encapsulation:2})}return n})();var Re=l(7643);let Ie=(()=>{class n{http;jsonUrl="assets/data/claims-expanded.json";constructor(t){this.http=t,console.log("%c<<< Start CLAIMS DUMMY service >>>","background: #fff3cd; color: #664d03; padding: 2px 5px;")}getClaimsByUser(t){return this.http.get(this.jsonUrl).pipe((0,M.T)(o=>o.users[t]?.claims||[]))}getAllClaims(){return this.http.get(this.jsonUrl).pipe((0,M.T)(t=>Object.values(t.users).flatMap(s=>s.claims||[])))}static \u0275fac=function(o){return new(o||n)(e.KVO(Re.Qq))};static \u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ye(n,a){1&n&&(e.j41(0,"div",5)(1,"div",6)(2,"span",7),e.EFF(3,"Cargando rol..."),e.k0s()()())}function Me(n,a){1&n&&(e.j41(0,"app-admin-claims")(1,"h2"),e.EFF(2,"Admin Claims"),e.k0s(),e.j41(3,"p"),e.EFF(4,"Here you can manage admin claims."),e.k0s()())}function De(n,a){1&n&&(e.j41(0,"app-executive-claims")(1,"h2"),e.EFF(2,"Executive Claims"),e.k0s(),e.j41(3,"p"),e.EFF(4,"Here you can manage executive claims."),e.k0s()())}function Ge(n,a){1&n&&(e.j41(0,"div",8),e.EFF(1," No se pudo determinar tu rol. Contacta al administrador. "),e.k0s())}let $=(()=>{class n{userService;claimsDummyService;role=null;showAdmin=!1;showExecutive=!1;isLoading=!0;constructor(t,o){this.userService=t,this.claimsDummyService=o}ngOnInit(){this.userService.getCurrentUserRole().subscribe(t=>{this.isLoading=!1,console.log("\u{1f9ea} Rol recibido desde el servicio:",t),this.role=t,"Administrador"===t?(this.showAdmin=!0,this.isLoading=!1):"Ejecutivo"===t?this.showExecutive=!0:console.warn("\u26a0\ufe0f Rol desconocido o no asignado")}),this.claimsDummyService.getAllClaims().subscribe(t=>{console.log("\u{1f4c4} Reclamos de todos los usuarios:",t)}),this.claimsDummyService.getClaimsByUser("0FnJKfeUI2T73kBGO5GCdlpUs6W2").subscribe({next:t=>{console.log("\u{1f4c4} Reclamos del usuario:",t)},error:t=>{console.error("\u274c Error al obtener los reclamos:",t)}})}static \u0275fac=function(o){return new(o||n)(e.rXU(y.D),e.rXU(Ie))};static \u0275cmp=e.VBU({type:n,selectors:[["app-claims-router"]],decls:7,vars:4,consts:[[1,"row"],[1,"col-12"],["class","d-flex justify-content-center align-items-center",4,"ngIf"],[4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"alert","alert-danger","mt-3"]],template:function(o,i){1&o&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,ye,4,0,"div",2),e.k0s(),e.j41(3,"div",1),e.DNE(4,Me,5,0,"app-admin-claims",3)(5,De,5,0,"app-executive-claims",3)(6,Ge,2,0,"div",4),e.k0s()()),2&o&&(e.R7$(2),e.Y8G("ngIf",i.isLoading),e.R7$(2),e.Y8G("ngIf",i.showAdmin),e.R7$(),e.Y8G("ngIf",i.showExecutive),e.R7$(),e.Y8G("ngIf",!i.isLoading&&!i.showAdmin&&!i.showExecutive))},dependencies:[g.MD,g.bT,se,Te],encapsulation:2})}return n})();const we=[{path:"",children:[{path:"",component:$},{path:"claims",component:$},{path:"todo",component:A},{path:"admin-users",children:[{path:"",loadComponent:()=>l.e(831).then(l.bind(l,6831)).then(n=>n.AdminUserManagementComponent)},{path:"edit-role/:uid",loadComponent:()=>l.e(923).then(l.bind(l,2923)).then(n=>n.UserRoleEditComponent)},{path:"profile-edit/:uid",loadComponent:()=>l.e(78).then(l.bind(l,4078)).then(n=>n.ProfileEditComponent)}]},{path:"analytics",loadComponent:()=>l.e(773).then(l.bind(l,8773)).then(n=>n.AnalyticsComponent)},{path:"notifications/:uid",loadComponent:()=>l.e(327).then(l.bind(l,2327)).then(n=>n.NotificationsComponent)},{path:"profile/:uid",loadComponent:()=>l.e(675).then(l.bind(l,9675)).then(n=>n.ProfileViewComponent)},{path:"**",redirectTo:""}]}]}}]);