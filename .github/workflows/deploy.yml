name: Deploy Angular App to GitHub Pages

# üöÄ Este workflow se ejecuta cada vez que se hace push a la rama master
on:
  push:
    branches:
      - master

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Descargar el c√≥digo de la rama master
      - name: Checkout code
        uses: actions/checkout@v3

      # 2Ô∏è‚É£ Configurar Node.js (la misma versi√≥n que usas localmente)
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      # 3Ô∏è‚É£ Instalar dependencias del proyecto
      # Usamos --legacy-peer-deps por si hay dependencias con conflictos de versiones
      - name: Install dependencies
        run: npm install --legacy-peer-deps

      # 4Ô∏è‚É£ Construir la aplicaci√≥n Angular para producci√≥n
      # IMPORTANTE: el --base-href debe apuntar a la subcarpeta de tu repo
      # Si tu app est√° en https://usuario.github.io/claimsaapp ‚Üí base-href /claimsaapp/
      - name: Build Angular App
        run: npm run build -- --configuration=production --base-href /claimsaapp/

      # 5Ô∏è‚É£ Copiar index.html como 404.html
      # Esto evita el error 404 al refrescar en rutas internas (SPA fix para GitHub Pages)
      - name: Create 404.html for SPA refresh
        run: cp dist/claimsaapp/index.html dist/claimsaapp/404.html

      # 6Ô∏è‚É£ Desplegar a la rama gh-pages
      # Usa la acci√≥n oficial de James Ives para GitHub Pages
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages            # Rama de despliegue
          folder: dist/claimsaapp     # Carpeta generada por el build de Angular
