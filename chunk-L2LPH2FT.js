import{a as $}from"./chunk-5Z7HKXYQ.js";import"./chunk-2BL6JQEY.js";import{a as H}from"./chunk-N6RA7QK6.js";import{d as W,g as z,l as B,m as q,n as G,q as J}from"./chunk-5RABQZIW.js";import"./chunk-3OADCOYV.js";import{$ as E,$a as D,Ba as h,Da as u,Ea as p,Fa as k,Ha as v,Ja as o,Ka as C,L as m,La as N,M as f,Ma as y,Na as A,Oa as V,Pa as M,Ta as I,Ya as T,a as P,b as x,ba as a,fa as S,ha as w,ib as F,jb as O,kb as R,la as b,mb as U,sa as d,ta as n,ua as r,va as _,vb as L,xb as j}from"./chunk-5TBBY7BX.js";var Q=()=>["/dashboard"],X=(s,e,t,i,l)=>({"badge-full-danger":s,"badge-full-success":e,"badge-full-warning":t,"badge-full-primary":i,"badge-full-secondary":l});function Y(s,e){if(s&1){let t=h();n(0,"div",37)(1,"button",38),u("click",function(){m(t);let l=p();return f(l.markAllAsRead())}),_(2,"i",39),o(3," Marcar todas como le\xEDdas "),r()()}if(s&2){let t=p();a(),d("disabled",t.allRead)}}function Z(s,e){if(s&1){let t=h();n(0,"div",41)(1,"div",42)(2,"div")(3,"strong",43),o(4),r(),_(5,"br"),n(6,"small",44),o(7),r(),o(8," | "),n(9,"small",45),o(10),r()(),n(11,"div",46)(12,"button",47),u("click",function(){let l=m(t).$implicit,c=p(2);return f(c.markAsRead(l))}),_(13,"i",48),o(14),r(),n(15,"button",49),u("click",function(){let l=m(t).$implicit,c=p(2);return f(c.deleteNotification(l))}),_(16,"i",50),o(17," Eliminar "),r()()()()}if(s&2){let t=e.$implicit;a(3),d("innerHTML",t.message,E),a(),C(t.message),a(3),N("Le\xEDda: ",t.read?"S\xED":"No"),a(2),d("ngClass",T(9,X,t.type==="urgente",t.type==="asignado",t.type==="editado",t.type==="cerrado",t.type==="admin-alert")),a(),N(" ",t.type==="asignado"?"Asignado":t.type==="urgente"?"Urgente":t.type==="editado"?"Editado":t.type==="admin-alert"?"Nueva Modificaci\xF3n":t.type==="cerrado"?"Cerrado":t.type," "),a(2),d("ngClass",t.read?"btn-warning":"btn-full --success")("disabled",t.read),a(),d("ngClass",t.read?"bi-check2-circle":"bi-check-lg"),a(),N(" ",t.read?"Notificaci\xF3n le\xEDda":"Marcar como le\xEDda"," ")}}function ee(s,e){if(s&1&&(n(0,"div"),b(1,Z,18,15,"div",40),r()),s&2){let t=p();a(),d("ngForOf",t.pagedNotifications)}}function te(s,e){s&1&&(n(0,"div",1)(1,"div",5)(2,"div",51),o(3," No tienes notificaciones. "),r()()())}function ie(s,e){if(s&1){let t=h();n(0,"li",34)(1,"a",35),u("click",function(l){let c=m(t).$implicit;return p().onPageChange(c),f(l.preventDefault())}),o(2),r()()}if(s&2){let t=e.$implicit,i=p();v("active",t===i.currentPage),a(2),C(t)}}var K=class s{constructor(e,t){this.notificationService=e;this.authService=t;console.log("\u{1F514} AdminNotifications inicializado")}uid="";notifications=[];filterState="todas";fechaOrden="desc";currentPage=1;itemsPerPage=10;ngOnInit(){this.authService.getAuthState().subscribe(e=>{if(!e){console.error("\u274C No hay usuario autenticado");return}this.uid=e.uid,console.log("%c\u{1F50D} UID: "+this.uid,"background:#6610f2;color:#fff;padding:2px 5px;"),this.loadNotifications()})}loadNotifications(){this.notificationService.getUserNotifications(this.uid).subscribe({next:e=>{this.notifications=e??[],console.log("\u{1F514} Notificaciones del admin:",e),this.currentPage=Math.min(this.currentPage,this.totalPages)},error:e=>console.error("\u274C Error al cargar notificaciones:",e)})}asDate(e){return e?e instanceof Date?e:typeof e=="number"?new Date(e):e.toDate?e.toDate():new Date(e):new Date(0)}get filteredNotifications(){let e=[...this.notifications];return this.filterState==="leidas"?e=e.filter(t=>t.read):this.filterState==="no-leidas"&&(e=e.filter(t=>!t.read)),e.sort((t,i)=>{let l=this.asDate(t.timestamp).getTime(),c=this.asDate(i.timestamp).getTime();return this.fechaOrden==="asc"?l-c:c-l}),e}get totalItems(){return this.filteredNotifications.length}get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.itemsPerPage))}get pages(){return Array.from({length:this.totalPages},(e,t)=>t+1)}get pagedNotifications(){let e=(this.currentPage-1)*this.itemsPerPage;return this.filteredNotifications.slice(e,e+this.itemsPerPage)}onPageChange(e){e<1||e>this.totalPages||(this.currentPage=e)}onItemsPerPageChange(e){let t=Number(e.target.value);this.itemsPerPage=t,this.currentPage=1}markAsRead(e){e.read||!e.id||this.notificationService.markAsRead(this.uid,e.id).then(()=>{e.read=!0,console.log(`\u2705 Notificaci\xF3n ${e.id} marcada como le\xEDda`)}).catch(t=>console.error("\u274C Error al marcar como le\xEDda:",t))}deleteNotification(e){e.id&&this.notificationService.deleteNotification(this.uid,e.id).then(()=>{this.notifications=this.notifications.filter(t=>t.id!==e.id),console.log(`\u{1F5D1}\uFE0F Notificaci\xF3n ${e.id} eliminada`),(this.currentPage-1)*this.itemsPerPage>=this.totalItems&&(this.currentPage=Math.max(1,this.currentPage-1))}).catch(t=>console.error("\u274C Error al eliminar notificaci\xF3n:",t))}markAllAsRead(){this.notificationService.markAllAsRead(this.uid).then(()=>{this.notifications=this.notifications.map(e=>x(P({},e),{read:!0})),console.log("\u2705 Todas las notificaciones marcadas como le\xEDdas.")}).catch(e=>console.error("\u274C Error al marcar todas como le\xEDdas:",e))}get allRead(){return this.notifications.length>0&&this.notifications.every(e=>e.read)}badgeClass(e){switch(e){case"asignado":return"text-bg-warning";case"editado":return"text-bg-primary";case"cerrado":return"text-bg-success";case"urgente":return"text-bg-danger";case"admin-alert":return"text-bg-dark";default:return"text-bg-secondary"}}onFiltersChanged(){this.currentPage=1}static \u0275fac=function(t){return new(t||s)(S($),S(H))};static \u0275cmp=w({type:s,selectors:[["app-admin-notifications"]],decls:74,vars:26,consts:[["noNotifs",""],[1,"row"],[1,"col-12","text-start","grid-margin"],[1,"card"],[1,"card-body"],[1,"col-12"],["aria-label","breadcrumb",1,""],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"col-12","grid-margin"],[1,"col-sm-12","col-md-7","d-flex","justify-content-start","align-items-center"],[1,"bi","bi-bell-fill","text-warning"],[1,"badge","badge-type","badge-outline-info"],[1,"col-sm-12","col-md-5","d-flex","justify-content-end","align-items-center"],["class","mb-3",4,"ngIf"],[1,"col-sm-12","col-md-12","d-flex","justify-content-between","align-items-center","mt-3"],[1,"py-3"],[1,"me-2","fw-semibold"],["role","group",1,"btn-group"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"form-select","form-select-sm","d-inline-block","w-auto",3,"ngModelChange","ngModel"],["value","desc"],["value","asc"],[1,"row","mt-4"],[4,"ngIf","ngIfElse"],[1,"col-12","d-flex","justify-content-between","align-items-center","mt-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"change","ngModel"],[3,"value"],["aria-label","Page navigation"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"mb-3"],[1,"btn","btn-full","--success","m-1",3,"click","disabled"],[1,"bi","bi-check2-all"],["class","list-group-item border my-2 p-3 rounded bg-light",4,"ngFor","ngForOf"],[1,"list-group-item","border","my-2","p-3","rounded","bg-light"],[1,"d-flex","justify-content-between","align-items-center"],[3,"innerHTML"],[1,"text-muted"],[1,"badge",3,"ngClass"],[1,"btn-group"],[1,"btn","m-1","btn-sm",3,"click","ngClass","disabled"],[1,"bi",3,"ngClass"],[1,"btn","btn-full","--danger","m-1","btn-sm",3,"click"],[1,"bi","bi-trash3-fill"],[1,"alert","alert-info","my-4"]],template:function(t,i){if(t&1){let l=h();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",1)(5,"div",5)(6,"nav",6)(7,"ol",7)(8,"li",8)(9,"a",9),o(10,"Home"),r()(),n(11,"li",10),o(12,"Admin Notificaciones"),r()()()()()()()()(),n(13,"div",1)(14,"div",11)(15,"div",3)(16,"div",4)(17,"div",1)(18,"div",12)(19,"h2"),_(20,"i",13),o(21," Notificaciones del Administrador "),n(22,"small",14),o(23),r()()(),n(24,"div",15),b(25,Y,4,1,"div",16),r(),n(26,"div",17)(27,"div",18)(28,"span",19),o(29,"Ordenar por estado:"),r(),n(30,"div",20)(31,"button",21),u("click",function(){return m(l),i.filterState="todas",f(i.onFiltersChanged())}),o(32,"Todas"),r(),n(33,"button",22),u("click",function(){return m(l),i.filterState="leidas",f(i.onFiltersChanged())}),o(34,"Le\xEDdas"),r(),n(35,"button",23),u("click",function(){return m(l),i.filterState="no-leidas",f(i.onFiltersChanged())}),o(36,"No le\xEDdas"),r()()(),n(37,"div",18)(38,"span",19),o(39,"Ordenar por fecha:"),r(),n(40,"select",24),M("ngModelChange",function(g){return m(l),V(i.fechaOrden,g)||(i.fechaOrden=g),f(g)}),u("ngModelChange",function(){return m(l),f(i.onFiltersChanged())}),n(41,"option",25),o(42,"M\xE1s reciente primero"),r(),n(43,"option",26),o(44,"M\xE1s antigua primero"),r()()()(),n(45,"div",5)(46,"div",27),b(47,ee,2,1,"div",28)(48,te,4,0,"ng-template",null,0,D),r()(),n(50,"div",5)(51,"div",29)(52,"div"),o(53," Elementos por p\xE1gina: "),n(54,"select",30),u("change",function(g){return m(l),f(i.onItemsPerPageChange(g))}),n(55,"option",31),o(56,"10"),r(),n(57,"option",31),o(58,"25"),r(),n(59,"option",31),o(60,"50"),r(),n(61,"option",31),o(62,"100"),r()()(),n(63,"nav",32)(64,"ul",33)(65,"li",34)(66,"a",35),u("click",function(g){return m(l),i.onPageChange(i.currentPage-1),f(g.preventDefault())}),o(67,"Anterior"),r()(),b(68,ie,3,3,"li",36),n(69,"li",34)(70,"a",35),u("click",function(g){return m(l),i.onPageChange(i.currentPage+1),f(g.preventDefault())}),o(71,"Siguiente"),r()()()(),n(72,"div"),o(73),r()()()()()()()()}if(t&2){let l=k(49);a(9),d("routerLink",I(25,Q)),a(14),y(" ",i.filteredNotifications.length," notificaci\xF3n",i.filteredNotifications.length===1?"":"es"," "),a(2),d("ngIf",i.notifications.length>0),a(6),v("active",i.filterState==="todas"),a(2),v("active",i.filterState==="leidas"),a(2),v("active",i.filterState==="no-leidas"),a(5),A("ngModel",i.fechaOrden),a(7),d("ngIf",i.filteredNotifications.length>0)("ngIfElse",l),a(7),d("ngModel",i.itemsPerPage),a(),d("value",10),a(2),d("value",25),a(2),d("value",50),a(2),d("value",100),a(4),v("disabled",i.currentPage===1),a(3),d("ngForOf",i.pages),a(),v("disabled",i.currentPage===i.totalPages),a(4),y(" P\xE1gina ",i.currentPage," de ",i.totalPages," ")}},dependencies:[U,F,O,R,j,L,J,q,G,B,W,z],encapsulation:2})};export{K as AdminNotificationsComponent};
