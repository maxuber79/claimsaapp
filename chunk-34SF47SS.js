import{h as P,j as v,k as u,m as b,n as S,o,s as $,t as M,u as c,v as O}from"./chunk-2BL6JQEY.js";import{a as A}from"./chunk-N6RA7QK6.js";import{E as C}from"./chunk-3OADCOYV.js";import{A as h,D as g,G as m,H as U,a as l,b as a,pb as D,r as i,s,u as n,x as p}from"./chunk-5TBBY7BX.js";var I=class d{constructor(e,r){this.http=e;this.authService=r;console.log("%c<<< Start USER service >>>","background: #fff3cd; color: #664d03; padding: 2px 5px;")}usersCollectionName="users";firestore=U(P);auth=U(C);getUserProfile(e){if(!e)return console.warn("\u26A0\uFE0F getUserProfile: UID no proporcionado."),s(void 0);let r=o(this.firestore,`${this.usersCollectionName}/${e}`);return console.log("\u{1F4C4} Obteniendo perfil para UID:",e),u(r).pipe(n(t=>{if(t)return console.log("\u2705 Perfil obtenido:",t),a(l({},t),{uid:e});console.warn("\u26A0\uFE0F No se encontr\xF3 perfil para UID:",e)}),p(t=>(console.error("\u274C Error al obtener el perfil del usuario:",t),s(void 0))))}createUserProfile(e){if(!e.uid)return i(Promise.reject("\u274C createUserProfile: UID del usuario es requerido."));let r=new Date,t=a(l({},e),{created_at:r,createdDate:r}),f=o(this.firestore,`${this.usersCollectionName}/${e.uid}`);return console.log("\u{1F4DD} Creando perfil para usuario:",t),i(M(f,t))}updateUserProfile(e,r){if(!e)return i(Promise.reject("\u274C updateUserProfile: UID no proporcionado."));let t=o(this.firestore,`${this.usersCollectionName}/${e}`);return console.log("\u{1F504} Actualizando perfil UID:",e,"con datos:",r),i(c(t,r))}deleteUserProfile(e){if(!e)return i(Promise.reject("\u274C deleteUserProfile: UID no proporcionado."));let r=o(this.firestore,`${this.usersCollectionName}/${e}`);return console.log("\u{1F5D1} Eliminando perfil UID:",e),i(S(r))}getUserData(e){return this.authService.getAuthState().pipe(h(r=>{if(console.log("\u{1F4E1} authService.getAuthState() emiti\xF3:",r),r&&r.uid){let t=o(this.firestore,`${this.usersCollectionName}/${r.uid}`);return u(t).pipe(n(f=>a(l({},f),{uid:r.uid})))}else return console.warn("\u26A0\uFE0F Usuario no autenticado o sesi\xF3n expirada"),s(null)}))}getAllUsers(){let e=b(this.firestore,"users");return v(e,{idField:"uid"})}toggleUserStatus(e,r){let t=o(this.firestore,`users/${e}`);return c(t,{activo:r})}updateUserRole(e,r){let t=o(this.firestore,`users/${e}`);return c(t,{rol:r})}getCurrentUserUid(){return this.authService.getAuthState().pipe(n(e=>e?.uid||null))}getCurrentUserRole(){return this.authService.getAuthState().pipe(h(e=>{if(e&&e.uid){let r=o(this.firestore,`${this.usersCollectionName}/${e.uid}`);return u(r).pipe(n(t=>t.rol||null))}else return console.warn("\u26A0\uFE0F No hay usuario autenticado"),s(null)}),p(e=>(console.error("\u274C Error al obtener el rol:",e),s(null))))}getExecutives(){let e=$(b(this.firestore,this.usersCollectionName),O("rol","==","Ejecutivo"));return v(e,{idField:"uid"})}static \u0275fac=function(r){return new(r||d)(m(D),m(A))};static \u0275prov=g({token:d,factory:d.\u0275fac,providedIn:"root"})};export{I as a};
