import{i as z}from"./chunk-VYWRVR3S.js";import{a as B}from"./chunk-5Z7HKXYQ.js";import"./chunk-2BL6JQEY.js";import{a as $}from"./chunk-N6RA7QK6.js";import{d as q,g as G,l as J,m as K,n as Q,q as X}from"./chunk-5RABQZIW.js";import"./chunk-3OADCOYV.js";import{$ as w,$a as F,Ba as N,Da as u,Ea as h,Fa as x,Ha as g,Ja as o,Ka as M,L as m,La as S,M as f,Ma as y,Na as V,Oa as I,Pa as D,Ta as T,Ya as A,a as C,b as P,ba as a,fa as _,g as E,ha as k,ib as O,jb as R,kb as U,la as b,mb as j,sa as d,sb as L,ta as n,ua as r,va as v,vb as H,xb as W}from"./chunk-5TBBY7BX.js";var Z=()=>["/dashboard"],ee=(c,e,t,i,l)=>({"badge-full-danger":c,"badge-full-success":e,"badge-full-warning":t,"badge-full-primary":i,"badge-full-secondary":l});function te(c,e){if(c&1){let t=N();n(0,"div",40)(1,"div",1)(2,"div",41),v(3,"strong",42)(4,"br"),n(5,"small",43),o(6),r(),o(7," | "),n(8,"small",44),o(9),r()(),n(10,"div",45)(11,"button",46),u("click",function(){let l=m(t).$implicit,s=h(2);return f(s.markAsRead(l))}),v(12,"i",47),o(13),r(),n(14,"button",48),u("click",function(){let l=m(t).$implicit,s=h(2);return f(s.deleteNotification(l))}),v(15,"i",49),o(16," Eliminar "),r()()()()}if(c&2){let t=e.$implicit;a(3),d("innerHTML",t.message,w),a(3),S("Le\xEDda: ",t.read?"S\xED":"No"),a(2),d("ngClass",A(8,ee,t.type==="urgente",t.type==="asignado",t.type==="editado",t.type==="cerrado",t.type==="admin-alert")),a(),S(" ",t.type==="asignado"?"Asignado":t.type==="urgente"?"Urgente":t.type==="editado"?"Editado":t.type==="admin-alert"?"Nueva Modificaci\xF3n":t.type==="cerrado"?"Cerrado":t.type," "),a(2),d("ngClass",t.read?"btn-full --warning":"btn-full --success")("disabled",t.read),a(),d("ngClass",t.read?"bi bi-check-all":"bi-check-lg"),a(),S(" ",t.read?"Notificaci\xF3n le\xEDda":"Marcar como le\xEDda"," ")}}function ie(c,e){if(c&1&&(n(0,"div"),b(1,te,17,14,"div",39),r()),c&2){let t=h();a(),d("ngForOf",t.pagedNotifications)}}function ne(c,e){c&1&&(n(0,"div",50),o(1,"No hay notificaciones"),r())}function oe(c,e){if(c&1){let t=N();n(0,"li",36)(1,"a",37),u("click",function(l){let s=m(t).$implicit;return h().onPageChange(s),f(l.preventDefault())}),o(2),r()()}if(c&2){let t=e.$implicit,i=h();g("active",t===i.currentPage),a(2),M(t)}}var Y=class c{constructor(e,t,i,l){this.route=e;this.auth=t;this.notificationService=i;this.alertService=l;console.log("\u{1F514} Componente de notificaciones inicializado")}uid="";notifications=[];loading=!0;filterState="todas";fechaOrden="desc";currentPage=1;itemsPerPage=10;ngOnInit(){return E(this,null,function*(){let e=this.route.snapshot.paramMap.get("uid");if(console.log("\u{1F50D} UID encontrado en componente de notificaciones:",e),!e){console.warn("\u274C No se encontr\xF3 UID en la ruta");return}this.notificationService.getUserNotifications(e).subscribe({next:t=>{this.notifications=t,console.log("\u{1F4E8} Notificaciones cargadas:",this.notifications)},error:t=>{console.error("\u274C Error cargando notificaciones:",t)}});try{console.log("\u{1F4E8} Notificaciones cargadas:",this.notifications)}catch(t){console.error("\u274C Error cargando notificaciones:",t)}finally{this.loading=!1}})}loadNotifications(){this.notificationService.getUserNotifications(this.uid).subscribe({next:e=>{this.notifications=e??[],this.currentPage=Math.min(this.currentPage,this.totalPages)},error:e=>console.error("\u274C Error al cargar notificaciones (exec):",e)})}asDate(e){return e?e instanceof Date?e:typeof e=="number"?new Date(e):e.toDate?e.toDate():new Date(e):new Date(0)}get filteredNotifications(){let e=[...this.notifications];return this.filterState==="leidas"?e=e.filter(t=>t.read):this.filterState==="no-leidas"&&(e=e.filter(t=>!t.read)),e.sort((t,i)=>{let l=this.asDate(t.timestamp).getTime(),s=this.asDate(i.timestamp).getTime();return this.fechaOrden==="asc"?l-s:s-l}),e}get totalItems(){return this.filteredNotifications.length}get totalPages(){return Math.max(1,Math.ceil(this.totalItems/this.itemsPerPage))}get pages(){return Array.from({length:this.totalPages},(e,t)=>t+1)}get pagedNotifications(){let e=(this.currentPage-1)*this.itemsPerPage;return this.filteredNotifications.slice(e,e+this.itemsPerPage)}onPageChange(e){e<1||e>this.totalPages||(this.currentPage=e)}onItemsPerPageChange(e){let t=Number(e.target.value);this.itemsPerPage=t,this.currentPage=1}onFiltersChanged(){this.currentPage=1}markAsRead(e){e.read||!e.id||this.notificationService.markAsRead(this.uid,e.id).then(()=>e.read=!0).catch(t=>console.error("\u274C Error al marcar como le\xEDda (exec):",t))}deleteNotification(e){e.id&&this.notificationService.deleteNotification(this.uid,e.id).then(()=>{this.notifications=this.notifications.filter(t=>t.id!==e.id),(this.currentPage-1)*this.itemsPerPage>=this.totalItems&&(this.currentPage=Math.max(1,this.currentPage-1))}).catch(t=>console.error("\u274C Error al eliminar notificaci\xF3n (exec):",t))}markAllAsRead(){this.notificationService.markAllAsRead(this.uid).then(()=>this.notifications=this.notifications.map(e=>P(C({},e),{read:!0}))).catch(e=>console.error("\u274C Error al marcar todas (exec):",e))}get allRead(){return this.notifications.length>0&&this.notifications.every(e=>e.read)}static \u0275fac=function(t){return new(t||c)(_(L),_($),_(B),_(z))};static \u0275cmp=k({type:c,selectors:[["app-notifications"]],decls:74,vars:26,consts:[["noNotificaciones",""],[1,"row"],[1,"col-12","text-start","grid-margin"],[1,"card"],[1,"card-body"],[1,"col-12"],["aria-label","breadcrumb",1,""],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"col-12","grid-margin"],[1,"col-sm-12","col-md-6"],[1,"bi","bi-bell-fill","text-warning"],[1,"badge","badge-type","badge-outline-info"],[1,"col-sm-12","col-md-6","d-flex","justify-content-end"],[1,"btn","btn-full","--success","m-1","btn-sm",3,"click","disabled"],[1,"bi","bi-check2-all"],[1,"col-sm-12","col-md-6","d-flex","justify-content-between","align-items-center"],[1,"py-3"],[1,"me-2","fw-semibold"],["role","group",1,"btn-group"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"btn","btn-outline-warning","btn-sm",3,"click"],[1,"col-sm-12","col-md-6","d-flex","justify-content-end","align-items-center"],[1,"form-select","form-select-sm","d-inline-block","w-auto",3,"ngModelChange","ngModel"],["value","desc"],["value","asc"],[1,"col-sm-12","col-md-12"],[4,"ngIf","ngIfElse"],[1,"col-12","d-flex","justify-content-between","align-items-center","py-3"],[1,"form-select","form-select-sm","d-inline-block","w-auto","ms-2",3,"change","ngModel"],[3,"value"],["aria-label","Page navigation"],[1,"pagination","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],["class","list-group-item border my-2 p-3 rounded bg-light",4,"ngFor","ngForOf"],[1,"list-group-item","border","my-2","p-3","rounded","bg-light"],[1,"col-sm-12","col-md-6","py-2"],[3,"innerHTML"],[1,"text-muted"],[1,"badge",3,"ngClass"],[1,"col-sm-12","col-md-6","py-2","d-flex","justify-content-md-end","align-items-md-center"],[1,"btn","m-1","btn-sm",3,"click","ngClass","disabled"],[1,"bi",3,"ngClass"],[1,"btn","btn-full","--danger","m-1","btn-sm",3,"click"],[1,"bi","bi-trash3-fill"],[1,"alert","alert-info","mt-3"]],template:function(t,i){if(t&1){let l=N();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",1)(5,"div",5)(6,"nav",6)(7,"ol",7)(8,"li",8)(9,"a",9),o(10,"Home"),r()(),n(11,"li",10),o(12,"Admin Notificaciones"),r()()()()()()()()(),n(13,"div",1)(14,"div",11)(15,"div",3)(16,"div",4)(17,"div",1)(18,"div",12)(19,"h2"),v(20,"i",13),o(21," Notificaciones "),n(22,"small",14),o(23),r()()(),n(24,"div",15)(25,"button",16),u("click",function(){return m(l),f(i.markAllAsRead())}),v(26,"i",17),o(27," Marcar todas como le\xEDdas "),r()(),n(28,"div",18)(29,"div",19)(30,"span",20),o(31,"Ordenar por estado:"),r(),n(32,"div",21)(33,"button",22),u("click",function(){return m(l),i.filterState="todas",f(i.onFiltersChanged())}),o(34,"Todas"),r(),n(35,"button",23),u("click",function(){return m(l),i.filterState="leidas",f(i.onFiltersChanged())}),o(36,"Le\xEDdas"),r(),n(37,"button",24),u("click",function(){return m(l),i.filterState="no-leidas",f(i.onFiltersChanged())}),o(38,"No le\xEDdas"),r()()()(),n(39,"div",25)(40,"span",20),o(41,"Ordenar por fecha:"),r(),n(42,"select",26),D("ngModelChange",function(p){return m(l),I(i.fechaOrden,p)||(i.fechaOrden=p),f(p)}),u("ngModelChange",function(){return m(l),f(i.onFiltersChanged())}),n(43,"option",27),o(44,"M\xE1s reciente primero"),r(),n(45,"option",28),o(46,"M\xE1s antigua primero"),r()()(),n(47,"div",29),b(48,ie,2,1,"div",30)(49,ne,2,0,"ng-template",null,0,F),r(),n(51,"div",31)(52,"div"),o(53," Elementos por p\xE1gina: "),n(54,"select",32),u("change",function(p){return m(l),f(i.onItemsPerPageChange(p))}),n(55,"option",33),o(56,"10"),r(),n(57,"option",33),o(58,"25"),r(),n(59,"option",33),o(60,"50"),r(),n(61,"option",33),o(62,"100"),r()()(),n(63,"nav",34)(64,"ul",35)(65,"li",36)(66,"a",37),u("click",function(p){return m(l),i.onPageChange(i.currentPage-1),f(p.preventDefault())}),o(67,"Anterior"),r()(),b(68,oe,3,3,"li",38),n(69,"li",36)(70,"a",37),u("click",function(p){return m(l),i.onPageChange(i.currentPage+1),f(p.preventDefault())}),o(71,"Siguiente"),r()()()(),n(72,"div"),o(73),r()()()()()()()}if(t&2){let l=x(50);a(9),d("routerLink",T(25,Z)),a(14),y(" ",i.filteredNotifications.length," notificaci\xF3n",i.filteredNotifications.length===1?"":"es"," "),a(2),d("disabled",i.allRead),a(8),g("active",i.filterState==="todas"),a(2),g("active",i.filterState==="leidas"),a(2),g("active",i.filterState==="no-leidas"),a(5),V("ngModel",i.fechaOrden),a(6),d("ngIf",i.filteredNotifications.length>0)("ngIfElse",l),a(6),d("ngModel",i.itemsPerPage),a(),d("value",10),a(2),d("value",25),a(2),d("value",50),a(2),d("value",100),a(4),g("disabled",i.currentPage===1),a(3),d("ngForOf",i.pages),a(),g("disabled",i.currentPage===i.totalPages),a(4),y(" P\xE1gina ",i.currentPage," de ",i.totalPages," ")}},dependencies:[j,O,R,U,W,H,X,K,Q,J,q,G],encapsulation:2})};export{Y as NotificationsComponent};
